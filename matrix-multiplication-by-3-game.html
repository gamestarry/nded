<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Matrix Weaver - An interactive game to learn matrix multiplication rules. Practice with letters and numbers to build mathematical confidence.">
    <meta name="keywords"
        content="matrix multiplication, math game, matrix calculator, mathematics, education, learning game">
    <meta name="author" content="NDED">
    <title>Matrix Weaver - Learn Matrix Multiplication | NDED</title>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts for NDED styling -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@800;900&family=Raleway:wght@400;500&family=Quicksand:wght@400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="canonical" href="https://nd-ed.org/matrix-multiplication-by-3-game.html">

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #8a2be2;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

            /* 游戏黏土风格变量 */
            --clay-bg: #E0E9FF;
            --clay-primary: #6B94FF;
            --clay-accent-pink: #FF99C8;
            --clay-accent-yellow: #FFD152;
            --clay-success: #10B981;
            --clay-selected: #6ED6A7;
            /* 新增：选中状态颜色（浅绿色） */
            --clay-purple: #A78BFA;
            --clay-dark-bg: #0A1931;
            --clay-gray: #94A3B8;
            --clay-shadow:
                8px 8px 16px rgba(0, 0, 0, 0.1),
                -4px -4px 12px rgba(255, 255, 255, 0.8),
                inset 4px 4px 8px rgba(255, 255, 255, 0.4),
                inset -4px -4px 8px rgba(0, 0, 0, 0.05);
            --clay-radius-lg: 30px;
            --clay-radius-sm: 12px;
            --text-dark: #2D3748;
            --text-light: #4A5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* 主行布局容器 */
        .main-row-container {
            width: 100%;
            background-color: #f9f9f9;
            padding: 0 0 1.5rem 0;
            position: relative;
            z-index: 1;
        }

        /* 更宽的容器，用于容纳三个并排的部分 */
        .wide-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* 主行布局 */
        .main-row {
            display: flex;
            gap: 1.5rem;
        }

        .left-sidebar,
        .right-sidebar {
            flex: 0 0 250px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.2rem;
            position: relative;
            z-index: 1;
        }

        .main-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        /* 动态内容容器样式 */
        .dynamic-content-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .dynamic-content-container h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
            border-bottom: none;
            padding-bottom: 0;
        }

        .dynamic-content-container p {
            color: var(--dark-color);
            text-align: center;
            max-width: 600px;
            margin: 0 auto 1.5rem;
        }

        /* 左侧边栏矩阵计算器边框 */
        .matrix-calc-banner {
            background: linear-gradient(135deg, var(--clay-primary) 0%, var(--clay-purple) 100%);
            border-radius: var(--clay-radius-sm);
            padding: 1rem;
            margin-top: 1.2rem;
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        .matrix-calc-banner h4 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 0.7rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .matrix-calc-button {
            display: inline-block;
            background: white;
            color: var(--clay-primary);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .matrix-calc-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            background: var(--clay-accent-yellow);
            color: var(--clay-dark-bg);
        }

        /* 左侧导航栏样式 */
        .nav-title {
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
            text-align: center;
        }

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .nav-button {
            background-color: var(--light-color);
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
            padding: 0.4rem 0.8rem;
            font-size: 0.95rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: block;
            font-weight: 500;
        }

        .nav-button:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-color: var(--secondary-color);
        }

        .nav-button:active {
            transform: translateY(0);
        }

        /* 为外部链接按钮添加外链标志 */
        .nav-button.external {
            position: relative;
            padding-right: 2.5rem;
            background-color: var(--light-color);
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
        }

        .nav-button.external::after {
            content: "↗";
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .nav-button.external:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .nav-button.external:hover::after {
            transform: translateY(-50%) translateX(2px) translateY(-2px);
        }

        /* 头部样式 - 已修改，整体缩小10% */
        header {
            background: linear-gradient(135deg, #00447F 0%, #0066AA 100%);
            color: white;
            padding: 0.2rem 0;
            text-align: center;
            margin-bottom: 0.4rem;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: visible;
            display: flex;
            align-items: center;
            min-height: 72px;
            z-index: 1000;
            transform: scaleY(0.9);
            transform-origin: top;
        }

        /* 添加微妙的纹理效果 */
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }

        /* 新的标题样式 - 缩小10% */
        .main-title {
            font-size: 2.3rem;
            margin-bottom: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            line-height: 1.2;
            font-family: 'Raleway', sans-serif;
            font-weight: 500;
            display: flex;
            align-items: flex-end;
            flex-wrap: wrap;
            justify-content: center;
            transform: scale(0.9);
            transform-origin: center;
        }

        /* NDED特殊样式 - 修改为向内凹的圆角，缩小10% */
        .nded-text {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 900;
            font-size: 2.6rem;
            color: #2c3e50;
            letter-spacing: 0.4px;
            display: inline-block;
            position: relative;
            padding: 0 9px;
            margin-right: 6px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow:
                inset 2.5px 2.5px 4px rgba(0, 0, 0, 0.2),
                inset -2.5px -2.5px 4px rgba(255, 255, 255, 0.8),
                0 1.5px 3px rgba(0, 0, 0, 0.1);
            border: 0.8px solid rgba(0, 0, 0, 0.1);
            line-height: 1.1;
            height: 52px;
            display: inline-flex;
            align-items: center;
        }

        /* 副标题样式 - 添加新的样式，缩小10% */
        .subtitle {
            font-size: 1.55rem;
            font-style: italic;
            color: #f0f0f0;
            text-shadow: 0.8px 0.8px 1.5px rgba(0, 0, 0, 0.3);
            font-weight: 400;
            margin-left: 6px;
            letter-spacing: 0.4px;
            line-height: 1.1;
            display: inline-flex;
            align-items: flex-end;
            height: 52px;
            position: relative;
        }

        /* 给NDED添加装饰性边框效果 */
        .nded-text::before {
            content: "";
            position: absolute;
            top: -2.5px;
            left: -2.5px;
            right: -2.5px;
            bottom: -2.5px;
            border: 0.8px solid rgba(255, 215, 0, 0.2);
            border-radius: 11.5px;
            z-index: -1;
        }

        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 0.4rem 0;
            margin-top: 2rem;
        }

        /* 右侧边栏样式 */
        .right-sidebar {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            min-height: 200px;
            padding: 1.2rem;
        }

        .right-sidebar-placeholder {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }

        /* 问答栏样式 */
        .question-box {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            padding: 1.2em;
            width: 100%;
            transition: all 0.3s ease;
            font-family: "Poppins", "Nunito", sans-serif;
        }

        .question-box h2 {
            font-size: 0.95rem;
            margin-bottom: 1.2em;
            color: #333;
        }

        .question-box .btn {
            display: block;
            width: 100%;
            padding: 0.65em 0.8em;
            margin-bottom: 0.65em;
            border-radius: 10px;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .question-box .yes {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
        }

        .question-box .yes:hover {
            transform: scale(1.05);
            box-shadow: 0 3.6px 9px rgba(120, 100, 255, 0.3);
        }

        .question-box .no {
            background: #ffe7e7;
            color: #ff4b4b;
        }

        .question-box .no:hover {
            transform: rotate(-2deg) scale(1.05);
            box-shadow: 0 3.6px 9px rgba(255, 75, 75, 0.2);
        }

        .question-box .response {
            margin-top: 1.2em;
            font-size: 0.85rem;
            color: #555;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .question-box .response.show {
            opacity: 1;
        }

        /* ===== 3x3游戏样式开始 ===== */
        /* 游戏容器样式 */
        .game-wrapper {
            background-color: var(--clay-bg);
            border-radius: var(--clay-radius-lg);
            padding: 12px;
            margin-top: -5px;
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            font-family: 'Quicksand', sans-serif;
            position: relative;
        }

        /* 游戏标题容器 */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            position: relative;
        }

        /* 游戏标题 */
        .game-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--clay-dark-bg);
            text-align: center;
            margin: 0;
            padding: 0 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
            flex: 1;
        }

        /* 声音控制按钮位置 */
        .game-sound-controls {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 10;
        }

        .sound-toggle-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(107, 148, 255, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--clay-shadow);
            transition: all 0.25s ease;
            color: var(--clay-primary);
        }

        .sound-toggle-btn:hover {
            transform: scale(1.1);
            background: var(--clay-primary);
            color: white;
            border-color: var(--clay-primary);
        }

        .sound-toggle-btn.muted {
            background: rgba(255, 255, 255, 0.7);
            color: var(--clay-gray);
            border-color: var(--clay-gray);
        }

        .sound-toggle-btn.muted:hover {
            background: var(--clay-gray);
            color: white;
            border-color: var(--clay-gray);
        }

        /* 星星容器，包含返回按钮和星星 */
        .stars-container {
            position: relative;
            width: 100%;
            max-width: 950px;
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }

        /* 星星与状态 */
        .stars-row {
            display: flex;
            gap: 12px;
            margin-bottom: 5px;
        }

        .star {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: var(--clay-gray);
            transition: 0.25s ease;
            user-select: none;
        }

        .star.active {
            background: var(--clay-accent-yellow);
            color: var(--clay-dark-bg);
            box-shadow: var(--clay-shadow);
            transform: scale(1.1);
        }

        .status-container {
            text-align: center;
            margin-bottom: 12px;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--clay-radius-sm);
            box-shadow: var(--clay-shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 8px 12px;
            backdrop-filter: blur(5px);
            max-width: 950px;
            margin: 0 auto 12px;
        }

        .status-label {
            font-weight: 700;
            color: var(--clay-dark-bg);
            font-size: 1rem;
            margin-bottom: 6px;
        }

        .hint-text {
            font-size: 0.85rem;
            color: var(--clay-primary);
            font-style: italic;
            margin-top: 4px;
            animation: clay-pulse 2s infinite;
        }

        @keyframes clay-pulse {

            0%,
            100% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }
        }

        /* 核心 Playground - 粘土风格 */
        .playground {
            background: rgba(255, 255, 255, 0.8);
            padding: 12px;
            border-radius: var(--clay-radius-lg);
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 100%;
            max-width: 950px;
            backdrop-filter: blur(5px);
            transition: box-shadow 0.25s ease;
            margin-bottom: 12px;
            margin: 0 auto 12px;
        }

        .playground:hover {
            box-shadow: var(--clay-shadow);
        }

        /* 修改：将矩阵布局改为两行 */
        .matrices {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            justify-content: center;
            width: 100%;
            padding: 0 8px;
        }

        /* 第一行：矩阵A、乘号、矩阵B */
        .matrix-row-1 {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            width: 100%;
        }

        /* 第二行：等号、矩阵C */
        .matrix-row-2 {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            width: 100%;
        }

        .matrix {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--clay-radius-sm);
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            flex-shrink: 0;
            transition: none;
        }

        /* 矩阵单元格 */
        .cell {
            aspect-ratio: 1;
            border-radius: 4px !important;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.25s ease;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            cursor: grab;
            width: 48px;
            height: 48px;
        }

        #matA .cell {
            color: var(--clay-primary);
            border-color: rgba(107, 148, 255, 0.3);
        }

        #matA .cell.highlight {
            background: var(--clay-primary);
            color: white;
            box-shadow: var(--clay-shadow);
            border-color: var(--clay-primary);
        }

        #matB .cell {
            color: #92400e;
            border-color: rgba(255, 209, 82, 0.3);
        }

        #matB .cell.highlight {
            background: var(--clay-accent-yellow);
            color: var(--clay-dark-bg);
            box-shadow: var(--clay-shadow);
            border-color: var(--clay-accent-yellow);
        }

        #matC .cell {
            border: 2px dashed rgba(107, 148, 255, 0.3);
            color: var(--text-light);
            cursor: pointer;
            background: rgba(255, 255, 255, 0.8);
        }

        /* 新增：结果矩阵单元格选中状态（浅绿色） */
        #matC .cell.selected {
            background: var(--clay-selected);
            color: var(--clay-dark-bg);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow:
                0 0 0 3px rgba(110, 214, 167, 0.4),
                8px 8px 16px rgba(0, 0, 0, 0.1),
                -4px -4px 12px rgba(255, 255, 255, 0.8),
                inset 4px 4px 8px rgba(255, 255, 255, 0.6);
            font-weight: 800;
            animation: pulse-selected 1.5s infinite alternate;
            position: relative;
        }

        /* 选中状态脉冲动画 */
        @keyframes pulse-selected {
            0% {
                box-shadow:
                    0 0 0 3px rgba(110, 214, 167, 0.3),
                    8px 8px 16px rgba(0, 0, 0, 0.1),
                    -4px -4px 12px rgba(255, 255, 255, 0.8),
                    inset 4px 4px 8px rgba(255, 255, 255, 0.6);
            }

            100% {
                box-shadow:
                    0 0 0 3px rgba(110, 214, 167, 0.6),
                    8px 8px 16px rgba(0, 0, 0, 0.1),
                    -4px -4px 12px rgba(255, 255, 255, 0.8),
                    inset 4px 4px 8px rgba(255, 255, 255, 0.6);
            }
        }

        /* 可选：在选中状态的单元格中添加一个小图标 */
        #matC .cell.selected::after {
            content: "↻";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            opacity: 0.8;
        }

        /* 完成状态的单元格可以添加对勾 */
        #matC .cell.done::after {
            content: "✓";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        #matC .cell.done {
            background: var(--clay-success);
            color: white;
            border: 2px solid var(--clay-success);
            cursor: default;
            box-shadow: var(--clay-shadow);
            animation: none;
        }

        /* 为矩阵C的单元格添加点击动效 */
        #matC .cell:active {
            transform: scale(0.95);
            box-shadow: var(--clay-shadow);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        /* 移动端选中状态 */
        .cell.selected {
            outline: 4px solid var(--clay-accent-pink);
            transform: scale(1.05);
            z-index: 10;
            box-shadow: var(--clay-shadow);
        }

        /* 拖拽克隆元素 */
        .cell.drag-clone {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            margin: 0 !important;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.8;
            transform: translate3d(0, 0, 0) scale(1.1);
            box-shadow:
                0 15px 35px rgba(0, 0, 0, 0.2),
                var(--clay-shadow);
            transition: none !important;
            will-change: transform;
        }

        /* 运算符 */
        .operator {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--clay-gray);
            flex-shrink: 0;
            margin: 0 6px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* 公式插槽和按钮容器 */
        .dock-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 10px;
            margin-top: 5px;
        }

        .dock {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            opacity: 0;
            pointer-events: none;
            transition: 0.25s ease;
            flex-wrap: wrap;
            justify-content: center;
            box-shadow: var(--clay-shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            flex-grow: 0.4;
            max-width: calc(100% - 140px);
        }

        .dock.show {
            opacity: 1;
            pointer-events: all;
        }

        .slot {
            width: 42px;
            height: 42px;
            border-radius: 4px !important;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            background: white;
            font-size: 0.9rem;
            transition: all 0.25s ease;
            box-shadow: var(--clay-shadow);
            border: 2px dashed rgba(107, 148, 255, 0.5);
        }

        .slot-a {
            border-color: rgba(107, 148, 255, 0.5);
            background: rgba(107, 148, 255, 0.1);
        }

        .slot-b {
            border-color: rgba(255, 209, 82, 0.5);
            background: rgba(255, 209, 82, 0.1);
        }

        .slot.filled {
            border-style: solid;
            color: var(--clay-dark-bg);
        }

        .slot.hover {
            transform: scale(1.1);
            border-width: 3px;
            background-color: rgba(107, 148, 255, 0.2);
        }

        /* 快速解决按钮样式 */
        #solveBtn {
            flex-shrink: 0;
            white-space: nowrap;
            display: none;
            padding: 8px 16px;
            border-radius: var(--clay-radius-sm);
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
            color: white;
            touch-action: manipulation;
            box-shadow: var(--clay-shadow);
            background: var(--clay-success);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        #solveBtn:hover {
            transform: translateY(-2px);
            box-shadow: var(--clay-shadow);
        }

        /* 底部工具栏 */
        .tools-area {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 950px;
            margin: 0 auto;
        }

        /* 粘土按钮样式覆盖 */
        .clay-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 20px;
            border-radius: var(--clay-radius-sm);
            border: none;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
            user-select: none;
            touch-action: manipulation;
            text-decoration: none;
            color: white;
        }

        .clay-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.5s;
        }

        .clay-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--clay-shadow);
        }

        .clay-btn:hover::before {
            left: 100%;
        }

        .clay-btn:active {
            transform: translateY(0);
            box-shadow: var(--clay-shadow);
        }

        /* 按钮颜色变体 */
        .clay-btn-green {
            background: var(--clay-success);
        }

        .clay-btn-blue {
            background: var(--clay-primary);
        }

        .clay-btn-gray {
            background: var(--clay-gray);
        }

        .clay-btn-purple {
            background: var(--clay-purple);
        }

        .btn-link {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 庆祝通知 - 粘土风格 */
        #miniNotice {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: var(--clay-radius-lg);
            box-shadow:
                0 20px 50px rgba(0, 0, 0, 0.2),
                var(--clay-shadow);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            border: 3px solid var(--clay-success);
            text-align: center;
            backdrop-filter: blur(20px);
            animation: clay-bounce 0.5s ease;
            max-width: 400px;
            margin: 0 auto;
        }

        @keyframes clay-bounce {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        /* 按钮容器 - 用于弹窗中的按钮布局 */
        .notice-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        @media (min-width: 480px) {
            .notice-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }

        /* ===== SEO文章样式开始 ===== */
        /* 文章容器 - 独立样式，不与游戏页面样式冲突 */
        .seo-article-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }

        /* 文章标题样式 - 确保背景为白色 */
        .seo-article-container h1,
        .seo-article-container h2,
        .seo-article-container h3,
        .seo-article-container h4 {
            background-color: white !important;
            color: #2c3e50;
            padding: 0;
            margin: 0;
        }

        /* 文章主标题 */
        .seo-article-container .article-header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a6fa5;
            background-color: white;
        }

        .seo-article-container .article-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
            background: white !important;
        }

        .seo-article-container .article-subtitle {
            color: #7b8a8b;
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* 文章内容区域 */
        .seo-article-container .article-section {
            margin-bottom: 35px;
        }

        /* 文章二级标题 - 确保白色背景 */
        .seo-article-container .article-section h2 {
            font-size: 1.8rem;
            margin: 25px 0 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #eaeaea;
            background-color: white !important;
            color: #2c3e50;
        }

        /* 文章三级标题 */
        .seo-article-container .article-section h3 {
            color: #3498db;
            font-size: 1.4rem;
            margin: 20px 0 8px;
            background-color: white !important;
        }

        /* 段落样式 */
        .seo-article-container p {
            margin-bottom: 14px;
            font-size: 1rem;
            color: #444;
        }

        /* 列表样式 */
        .seo-article-container ul,
        .seo-article-container ol {
            margin-left: 20px;
            margin-bottom: 18px;
        }

        .seo-article-container li {
            margin-bottom: 6px;
            padding-left: 5px;
        }

        /* 特殊内容块样式 */
        .seo-article-container .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 18px;
        }

        .seo-article-container .section-number {
            background-color: #4a6fa5;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 12px;
        }

        .seo-article-container .gameplay-steps {
            background-color: #f1f8ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .seo-article-container .step {
            display: flex;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #d1e3f6;
        }

        .seo-article-container .step:last-child {
            border-bottom: none;
        }

        .seo-article-container .step-number {
            background-color: #3498db;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .seo-article-container .tip-box {
            background-color: #fff8e1;
            border-radius: 10px;
            padding: 18px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
        }

        .seo-article-container .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .seo-article-container .key-point {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            border-top: 4px solid #4a6fa5;
        }

        .seo-article-container .key-point h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1rem;
            background-color: white !important;
        }

        /* 图片区域样式 */
        .seo-article-container .teacher-images {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 25px 0;
        }

        .seo-article-container .image-container {
            flex: 1;
            min-width: 280px;
            max-width: 450px;
            text-align: center;
        }

        .seo-article-container .game-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 12px;
        }

        .seo-article-container .game-image:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .seo-article-container .image-caption {
            font-style: italic;
            color: #666;
            text-align: center;
            font-size: 0.9rem;
            padding: 0 8px;
        }

        /* 文章页脚 */
        .seo-article-container .article-footer {
            text-align: center;
            margin-top: 35px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
            color: #7b8a8b;
            font-size: 0.85rem;
        }

        /* ============ 移动端响应式优化 ============ */
        @media (max-width: 768px) {
            .main-row {
                flex-direction: column;
                gap: 1rem;
            }

            .left-sidebar,
            .right-sidebar {
                flex: 1;
                padding: 1rem !important;
            }

            .main-title {
                font-size: 1.6rem;
                flex-direction: column;
                align-items: center;
            }

            .nded-text {
                font-size: 1.8rem;
                margin-right: 0;
                margin-bottom: 4px;
                height: 40px;
                padding: 0 8px;
                border-radius: 8px;
            }

            .subtitle {
                font-size: 1.1rem;
                margin-left: 0;
                text-align: center;
                height: auto;
                line-height: 1.3;
                display: block;
                margin-top: 4px;
            }

            header {
                flex-direction: column;
                padding: 0.4rem 0;
                min-height: 90px;
                margin-bottom: 0.3rem;
            }

            .wide-container {
                padding: 0 10px !important;
            }

            .dynamic-content-container {
                padding: 1rem !important;
                margin-bottom: 1rem;
            }

            /* 游戏响应式调整 */
            .game-wrapper {
                padding: 10px !important;
                border-radius: 20px;
                margin-top: -3px;
            }

            .game-header {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .game-title {
                font-size: 1.6rem;
                margin-bottom: 8px;
                text-align: center;
            }

            .game-sound-controls {
                position: absolute;
                top: 0;
                right: 0;
            }

            .sound-toggle-btn {
                width: 36px;
                height: 36px;
                font-size: 1.3rem;
            }

            .stars-container {
                max-width: 95%;
            }

            .playground {
                padding: 10px 8px !important;
                border-radius: 20px;
                gap: 6px;
                max-width: 95%;
                margin-bottom: 10px;
            }

            .matrices {
                gap: 6px !important;
                padding: 0 5px !important;
            }

            .matrix-row-1,
            .matrix-row-2 {
                gap: 10px !important;
                flex-wrap: wrap;
                justify-content: center;
            }

            .matrix {
                padding: 8px !important;
                min-width: 150px !important;
                gap: 5px !important;
            }

            /* 移动端单元格尺寸调整 */
            .cell {
                width: 38px !important;
                height: 38px !important;
                font-size: 0.9rem !important;
                border-radius: 4px !important;
            }

            /* 移动端选中状态调整 */
            #matC .cell.selected {
                box-shadow:
                    0 0 0 2px rgba(110, 214, 167, 0.4),
                    4px 4px 8px rgba(0, 0, 0, 0.1),
                    -2px -2px 6px rgba(255, 255, 255, 0.8),
                    inset 2px 2px 4px rgba(255, 255, 255, 0.6);
            }

            @keyframes pulse-selected {
                0% {
                    box-shadow:
                        0 0 0 2px rgba(110, 214, 167, 0.3),
                        4px 4px 8px rgba(0, 0, 0, 0.1),
                        -2px -2px 6px rgba(255, 255, 255, 0.8),
                        inset 2px 2px 4px rgba(255, 255, 255, 0.6);
                }

                100% {
                    box-shadow:
                        0 0 0 2px rgba(110, 214, 167, 0.5),
                        4px 4px 8px rgba(0, 0, 0, 0.1),
                        -2px -2px 6px rgba(255, 255, 255, 0.8),
                        inset 2px 2px 4px rgba(255, 255, 255, 0.6);
                }
            }

            .operator {
                font-size: 1.3rem !important;
                margin: 0 4px !important;
                min-width: 12px;
            }

            /* 移动端调整dock容器布局 */
            .dock-container {
                flex-direction: column;
                gap: 8px;
                margin-top: 8px;
            }

            .dock {
                padding: 8px 14px !important;
                gap: 4px !important;
                max-width: 100%;
                flex-wrap: wrap;
            }

            .slot {
                width: 32px !important;
                height: 32px !important;
                font-size: 0.8rem !important;
                border-radius: 4px !important;
            }

            /* 移动端按钮调整 */
            #solveBtn {
                width: 100%;
                max-width: 160px;
                padding: 7px 12px;
                font-size: 0.75rem;
            }

            .star {
                width: 28px;
                height: 28px;
                font-size: 1.4rem;
            }

            .status-container {
                padding: 6px 10px !important;
                margin-bottom: 10px;
            }

            .status-label {
                font-size: 0.95rem;
            }

            .hint-text {
                font-size: 0.8rem;
                padding: 0 8px;
            }

            .clay-btn {
                padding: 7px 14px;
                font-size: 0.75rem;
            }

            .tools-area {
                margin-top: 10px;
                gap: 8px;
                max-width: 95%;
            }

            #miniNotice {
                padding: 15px 20px;
                max-width: 85%;
            }

            .notice-buttons {
                flex-direction: column;
            }

            /* SEO文章容器响应式 */
            .seo-article-container {
                padding: 1rem !important;
                margin-top: 1rem;
            }

            .seo-article-container .article-header h1 {
                font-size: 1.8rem;
            }

            .seo-article-container .article-section h2 {
                font-size: 1.5rem;
            }

            .seo-article-container .section-header {
                margin-bottom: 15px;
            }

            .seo-article-container .gameplay-steps {
                padding: 15px;
            }

            /* 导航按钮在移动端改为每行2个 */
            .nav-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }

            .nav-button {
                font-size: 0.8rem;
                padding: 0.6rem 0.4rem;
            }

            .matrix-calc-banner {
                margin-top: 1rem;
                padding: 0.8rem;
            }

            .matrix-calc-banner h4 {
                font-size: 1rem;
            }

            .matrix-calc-button {
                padding: 0.5rem 0.9rem;
                font-size: 0.85rem;
            }
        }

        /* ============ 针对小屏幕手机的优化 (宽度 ≤ 480px) ============ */
        @media (max-width: 480px) {
            .wide-container {
                padding: 0 8px !important;
            }

            .dynamic-content-container {
                padding: 0.8rem !important;
                margin-bottom: 0.8rem;
            }

            /* 导航按钮在小屏幕设备上的调整 */
            .nav-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .nav-button {
                font-size: 0.75rem;
                padding: 0.5rem 0.3rem;
            }

            /* 超小屏幕游戏优化 */
            .game-title {
                font-size: 1.4rem;
                margin-bottom: 6px;
            }

            .game-wrapper {
                padding: 8px !important;
                border-radius: 16px;
            }

            .game-sound-controls {
                top: -5px;
                right: -5px;
            }

            .sound-toggle-btn {
                width: 32px;
                height: 32px;
                font-size: 1.1rem;
            }

            .playground {
                padding: 8px 5px !important;
                border-radius: 16px;
                gap: 5px;
                max-width: 100%;
                margin-bottom: 8px;
            }

            .matrices {
                gap: 5px !important;
                padding: 0 3px !important;
            }

            .matrix-row-1,
            .matrix-row-2 {
                gap: 8px !important;
            }

            .matrix {
                min-width: 125px !important;
                padding: 6px !important;
                gap: 4px !important;
            }

            .cell {
                width: 32px !important;
                height: 32px !important;
                font-size: 0.75rem !important;
                border-radius: 3px !important;
                border-width: 1px !important;
            }

            .operator {
                font-size: 1.1rem !important;
                margin: 0 3px !important;
                min-width: 8px;
            }

            .dock-container {
                gap: 6px;
                margin-top: 6px;
            }

            .dock {
                padding: 6px 10px !important;
                gap: 3px !important;
                border-radius: 20px;
                max-width: 100%;
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .dock::-webkit-scrollbar {
                display: none;
            }

            .slot {
                width: 28px !important;
                height: 28px !important;
                font-size: 0.7rem !important;
                min-width: 28px;
                border-radius: 3px !important;
                border-width: 1px !important;
            }

            #solveBtn {
                max-width: 140px;
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            .stars-row {
                gap: 8px;
                margin-bottom: 4px;
            }

            .star {
                width: 24px;
                height: 24px;
                font-size: 1.2rem;
            }

            .status-container {
                padding: 5px 8px !important;
                margin-bottom: 8px;
            }

            .status-label {
                font-size: 0.85rem;
            }

            .hint-text {
                font-size: 0.7rem;
                padding: 0 4px;
            }

            .clay-btn {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            .tools-area {
                gap: 6px;
            }

            #miniNotice {
                padding: 12px 16px;
                max-width: 90%;
            }

            .notice-buttons {
                gap: 6px;
            }

            .matrix-calc-banner {
                padding: 0.7rem;
            }

            .matrix-calc-banner h4 {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .matrix-calc-button {
                padding: 0.4rem 0.7rem;
                font-size: 0.8rem;
            }

            .seo-article-container {
                padding: 0.8rem !important;
                margin-top: 0.8rem;
            }

            .seo-article-container .article-header h1 {
                font-size: 1.6rem;
            }

            .seo-article-container .article-section h2 {
                font-size: 1.3rem;
            }

            .seo-article-container .key-points {
                grid-template-columns: 1fr;
            }
        }

        /* 游戏功能面板 */
        #masterPanel {
            display: none;
            gap: 10px;
        }

        /* ===== 3x3游戏样式结束 ===== */

        /* 原有的响应式样式 */
        @media (max-width: 768px) {
            .seo-article-container .teacher-images {
                flex-direction: column;
                align-items: center;
            }

            .seo-article-container .image-container {
                min-width: 100%;
            }

            .seo-article-container .game-image {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .seo-article-container .game-image {
                max-width: 100%;
            }

            .seo-article-container .teacher-images {
                gap: 15px;
            }

            .seo-article-container .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .seo-article-container .section-number {
                margin-bottom: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- 页眉部分 -->
    <header>
        <div class="container">
            <h1 class="main-title">
                <span class="nded-text">NDED</span>
                <span class="subtitle">building mathematical confidence for life.</span>
            </h1>
        </div>
    </header>

    <!-- 主内容区域 -->
    <div class="main-row-container">
        <div class="wide-container">
            <div class="main-row">
                <!-- 左侧边栏 -->
                <div class="left-sidebar">
                    <h3 class="nav-title">Navigation</h3>
                    <div class="nav-buttons">
                        <a href="index.html" class="nav-button">Home</a>
                        <a href="about-us.html" class="nav-button">About us</a>
                        <a href="#content" class="nav-button">Content</a>
                        <a href="https://matrixcalcu.com/" target="_blank" class="nav-button external">Matrix
                            Calculator</a>
                    </div>

                    <!-- 新增：矩阵计算器边框 -->
                    <div class="matrix-calc-banner">
                        <h4>Want to calculate actual matrices?</h4>
                        <a href="https://matrixcalcu.com/" target="_blank" class="matrix-calc-button">
                            Open Matrix Calculator
                        </a>
                    </div>
                </div>

                <!-- 主内容区域 - 游戏 -->
                <div class="main-content">
                    <div class="dynamic-content-container">
                        <div class="game-wrapper">
                            <!-- 3x3游戏开始 -->
                            <div class="game-header">
                                <h1 class="game-title">Matrix Multiplication Rules</h1>
                                <!-- 声音控制按钮放在游戏右上角 -->
                                <div class="game-sound-controls">
                                    <button id="soundToggleBtn" class="sound-toggle-btn">🔊</button>
                                </div>
                            </div>

                            <!-- 修改弹窗结构，为第三关添加不同的按钮 -->
                            <div id="miniNotice">
                                <h2 id="noticeTitle" style="margin:0; color:var(--clay-success)">Perfect!</h2>
                                <p id="noticeBody" style="margin:10px 0 20px; color:var(--text-medium)">Moving to the
                                    next challenge...</p>
                                <p id="practiceText"
                                    style="display:none; margin:10px 0 20px; color:var(--clay-primary); font-weight:500; font-size:1.1rem;">
                                    Congratulations! You've mastered 3x3 matrix multiplication!</p>

                                <div class="notice-buttons">
                                    <button class="clay-btn clay-btn-green" id="continueBtn"
                                        onclick="closeNotice()">Continue ➡</button>
                                    <a id="matrixCalcBtn"
                                        href="https://matrixcalcu.com/en/matrix-multiplication-calculator"
                                        target="_blank" style="display:none;"
                                        class="clay-btn clay-btn-purple btn-link">📈 Matrix Calculator ↗</a>
                                    <button class="clay-btn clay-btn-blue" id="morePracticeBtn" style="display:none;"
                                        onclick="startMorePractice()">🔁 More Practice</button>
                                </div>
                            </div>

                            <!-- 修改：将星星和返回按钮放在同一个容器中 -->
                            <div class="stars-container">

                                <div class="stars-row">
                                    <div class="star" id="s1">★</div>
                                    <div class="star" id="s2">★</div>
                                    <div class="star" id="s3">★</div>
                                </div>
                            </div>

                            <div class="status-container">
                                <div class="status-label" id="statusLabel">3x3 Matrix: Level 1</div>
                                <div class="hint-text" id="hintText">Tip: Tap a '?' in Matrix C to begin weaving.</div>
                            </div>

                            <div class="playground">
                                <div class="matrices">
                                    <!-- 第一行：矩阵A、乘号、矩阵B -->
                                    <div class="matrix-row-1">
                                        <div class="matrix" id="matA">
                                            <div class="cell" data-r="0" data-c="0">a1</div>
                                            <div class="cell" data-r="0" data-c="1">a2</div>
                                            <div class="cell" data-r="0" data-c="2">a3</div>
                                            <div class="cell" data-r="1" data-c="0">a4</div>
                                            <div class="cell" data-r="1" data-c="1">a5</div>
                                            <div class="cell" data-r="1" data-c="2">a6</div>
                                            <div class="cell" data-r="2" data-c="0">a7</div>
                                            <div class="cell" data-r="2" data-c="1">a8</div>
                                            <div class="cell" data-r="2" data-c="2">a9</div>
                                        </div>
                                        <div class="operator">×</div>
                                        <div class="matrix" id="matB">
                                            <div class="cell" data-r="0" data-c="0">b1</div>
                                            <div class="cell" data-r="0" data-c="1">b2</div>
                                            <div class="cell" data-r="0" data-c="2">b3</div>
                                            <div class="cell" data-r="1" data-c="0">b4</div>
                                            <div class="cell" data-r="1" data-c="1">b5</div>
                                            <div class="cell" data-r="1" data-c="2">b6</div>
                                            <div class="cell" data-r="2" data-c="0">b7</div>
                                            <div class="cell" data-r="2" data-c="1">b8</div>
                                            <div class="cell" data-r="2" data-c="2">b9</div>
                                        </div>
                                    </div>

                                    <!-- 第二行：等号、矩阵C -->
                                    <div class="matrix-row-2">
                                        <div class="operator">=</div>
                                        <div class="matrix" id="matC">
                                            <div class="cell" onclick="initTask(0,0,this)">?</div>
                                            <div class="cell" onclick="initTask(0,1,this)">?</div>
                                            <div class="cell" onclick="initTask(0,2,this)">?</div>
                                            <div class="cell" onclick="initTask(1,0,this)">?</div>
                                            <div class="cell" onclick="initTask(1,1,this)">?</div>
                                            <div class="cell" onclick="initTask(1,2,this)">?</div>
                                            <div class="cell" onclick="initTask(2,0,this)">?</div>
                                            <div class="cell" onclick="initTask(2,1,this)">?</div>
                                            <div class="cell" onclick="initTask(2,2,this)">?</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 新增的dock容器，包含算式和Quick Solve按钮 -->
                                <div class="dock-container">
                                    <div class="dock" id="dock">
                                        <div class="slot slot-a" data-idx="0">?</div><span>×</span>
                                        <div class="slot slot-b" data-idx="1">?</div>
                                        <span style="padding:0 4px; color:var(--text-light); font-weight:bold">+</span>
                                        <div class="slot slot-a" data-idx="2">?</div><span>×</span>
                                        <div class="slot slot-b" data-idx="3">?</div>
                                        <span style="padding:0 4px; color:var(--text-light); font-weight:bold">+</span>
                                        <div class="slot slot-a" data-idx="4">?</div><span>×</span>
                                        <div class="slot slot-b" data-idx="5">?</div>
                                    </div>
                                    <!-- Quick Solve按钮现在在这里，与算式在同一行 -->
                                    <button class="clay-btn clay-btn-green" id="solveBtn" onclick="autoFill()">⚡ Quick
                                        Solve</button>
                                </div>
                            </div>

                            <div class="tools-area" id="finalTools">
                                <!-- 注意：Quick Solve按钮已被移到上面 -->
                                <div id="masterPanel" style="display:none; gap:12px;">
                                    <button class="clay-btn clay-btn-gray" onclick="location.reload()">🧠 Restart
                                        Training</button>
                                    <!-- ✅ 链接已修正：使用您指定的matrixcalcu.com链接 -->
                                    <a href="https://matrixcalcu.com/en/matrix-multiplication-calculator"
                                        target="_blank" class="clay-btn clay-btn-purple btn-link">📈 Matrix Calculator
                                        ↗</a>
                                </div>
                            </div>
                            <!-- 3x3游戏结束 -->
                        </div>
                    </div>

                    <!-- ===== SEO文章部分开始 ===== -->
                    <div class="seo-article-container">
                        <div class="article-header">
                            <h1>Matrix Multiplication Game</h1>
                            <p class="article-subtitle">An Interactive Learning Tool for Understanding Matrix Operations
                            </p>
                        </div>

                        <main>
                            <!-- Part 1: How to Play -->
                            <div class="article-section">
                                <div class="section-header">
                                    <div class="section-number">1</div>
                                    <h2>How to Play</h2>
                                </div>

                                <h3>Basic Gameplay</h3>

                                <div class="gameplay-steps">
                                    <div class="step">
                                        <div class="step-number">1</div>
                                        <div>
                                            <strong>Click to Start</strong> → Click any "?" cell in the result matrix
                                            (bottom matrix)
                                        </div>
                                    </div>

                                    <div class="step">
                                        <div class="step-number">2</div>
                                        <div>
                                            <strong>Auto-Highlight</strong> → The corresponding row in Matrix A and
                                            column in Matrix B will highlight automatically
                                        </div>
                                    </div>

                                    <div class="step">
                                        <div class="step-number">3</div>
                                        <div>
                                            <strong>Drag & Fill</strong> → Drag highlighted cells into the formula slots
                                            (Desktop: drag / Mobile: touch & drag)
                                        </div>
                                    </div>

                                    <div class="step">
                                        <div class="step-number">4</div>
                                        <div>
                                            <strong>Complete Calculation</strong> → The result calculates automatically
                                            when all 4 slots are filled, or click "Solve Current"
                                        </div>
                                    </div>
                                </div>

                                <h3>Game Progression</h3>
                                <ul>
                                    <li><strong>Level 1: Letter matrices</strong> - Learn basic rules</li>
                                    <li><strong>Level 2: Letter matrices</strong> - Practice & reinforce</li>
                                    <li><strong>Level 3: Number matrices</strong> - Actual calculations</li>
                                    <li><strong>Master Mode:</strong> Unlock advanced tools and 3×3 matrices</li>
                                </ul>

                                <div class="tip-box">
                                    <h3>Key Tips</h3>
                                    <ul>
                                        <li>Earn a star for each level completed</li>
                                        <li>Matrix multiplication formula: C[row][col] = (A[row][0] × B[0][col]) +
                                            (A[row][1] × B[1][col])</li>
                                        <li>Use "Restart Training" to reset progress anytime</li>
                                        <li>Reach Master Mode to unlock more tools and challenges</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Part 2: 2×2 Matrix Multiplication Rules -->
                            <div class="article-section">
                                <div class="section-header">
                                    <div class="section-number">2</div>
                                    <h2>2×2 Matrix Multiplication Rules</h2>
                                </div>

                                <p>In the 2×2 matrix mode, learners focus on understanding the basic conditions required
                                    for matrix multiplication. A 2×2 matrix can only be multiplied by another matrix if
                                    the number of columns in the first matrix matches the number of rows in the second
                                    matrix.</p>

                                <p>When multiplying two compatible matrices, the result is a new matrix whose dimensions
                                    are determined by the outer dimensions of the original matrices. In the 2×2 mode,
                                    this structure is easier to recognize, making it ideal for introducing matrix
                                    multiplication rules.</p>

                                <p>This mode is designed for beginners who are learning to identify valid and invalid
                                    matrix combinations. By practicing with smaller matrices, students can build
                                    confidence and develop a clear mental model of matrix multiplication rules before
                                    moving on to more complex cases.</p>

                                <div class="key-points">
                                    <div class="key-point">
                                        <h4>Compatibility Rule</h4>
                                        <p>Matrix A (m×n) can multiply with Matrix B (p×q) only if n = p (columns of A =
                                            rows of B).</p>
                                    </div>

                                    <div class="key-point">
                                        <h4>Result Dimensions</h4>
                                        <p>The product matrix will have dimensions m×q (rows from A, columns from B).
                                        </p>
                                    </div>

                                    <div class="key-point">
                                        <h4>Learning Focus</h4>
                                        <p>2×2 mode helps beginners visualize and internalize multiplication rules
                                            before calculations.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Part 3: Matrix Multiplication Rule Memory Game -->
                            <div class="article-section">
                                <div class="section-header">
                                    <div class="section-number">3</div>
                                    <h2>Matrix Multiplication Rule Memory Game</h2>
                                </div>

                                <p>The <strong>Matrix Multiplication Rule Memory Game</strong> is an educational
                                    learning game designed to help students memorize and understand the rules of matrix
                                    multiplication. Instead of focusing on calculations, this game trains learners to
                                    recognize valid matrix sizes, multiplication conditions, and result dimensions
                                    through structured memory-based practice.</p>

                                <h3>Why Memorizing Matrix Multiplication Rules Is Difficult</h3>

                                <p>Many students struggle with matrix multiplication not because of arithmetic
                                    difficulty, but because the rules themselves are easy to forget. Common challenges
                                    include remembering when two matrices can be multiplied, determining the correct
                                    order, and identifying the dimensions of the resulting matrix.</p>

                                <p>Traditional teaching often assumes these rules will be remembered naturally through
                                    repetition, but for many learners, this step requires focused and intentional
                                    practice.</p>

                                <h3>Not a Matrix Calculator or Problem Solver</h3>

                                <p>This game is not a matrix calculator and does not solve matrix multiplication
                                    problems automatically. Instead, it focuses exclusively on helping students
                                    internalize the rules behind matrix multiplication before performing calculations.
                                </p>

                                <p>By separating rule memorization from computation, learners build a stronger
                                    conceptual foundation and reduce confusion in later problem-solving tasks.</p>

                                <h3>How the Matrix Multiplication Rule Memory Game Works</h3>

                                <p>The game presents learners with matrix representations and rule-based questions that
                                    require them to recall and apply matrix multiplication conditions. Players must
                                    identify whether multiplication is possible and determine the correct result
                                    structure based on matrix dimensions.</p>

                                <p>Through repeated interaction, feedback, and progression, students gradually transform
                                    abstract rules into intuitive knowledge.</p>

                                <h3>What Makes This Learning Approach Different</h3>

                                <p>While most learning tools focus on completing matrix multiplication exercises, few
                                    address the need to memorize the rules themselves. This game targets that
                                    often-overlooked learning gap by using game mechanics to reinforce rule recognition.
                                </p>

                                <p>The result is a lower cognitive load, reduced anxiety, and improved long-term
                                    retention of matrix multiplication rules.</p>

                                <h3>Who This Game Is For</h3>

                                <ul>
                                    <li>Middle school and high school students learning matrices</li>
                                    <li>College students reviewing linear algebra fundamentals</li>
                                    <li>Teachers looking for interactive classroom tools</li>
                                    <li>Self-learners who want to strengthen conceptual understanding</li>
                                </ul>

                                <h3>Educational Benefits</h3>

                                <ul>
                                    <li>Improves recall of matrix multiplication conditions</li>
                                    <li>Builds confidence before performing calculations</li>
                                    <li>Encourages active learning through interaction</li>
                                    <li>Supports long-term conceptual understanding</li>
                                </ul>

                                <h3>Summary</h3>

                                <p>The Matrix Multiplication Rule Memory Game is a focused learning tool that helps
                                    students master matrix multiplication rules through memory-based practice. By
                                    emphasizing understanding before calculation, it provides a clearer and more
                                    confident path into linear algebra.</p>
                            </div>

                            <!-- Part 4: For Teachers: Classroom Use -->
                            <div class="article-section">
                                <div class="section-header">
                                    <div class="section-number">4</div>
                                    <h2>For Teachers: Classroom Use</h2>
                                </div>

                                <p>The Matrix Multiplication Rule Memory Game is designed to support classroom
                                    instruction by making abstract matrix rules visible and interactive. It can be used
                                    as a teaching aid before formal calculations are introduced.</p>

                                <!-- 图片区域 -->
                                <div class="teacher-images">
                                    <div class="image-container">
                                        <img src="img/matrix-game-03.png" alt="Matrix Game Screenshot 1"
                                            class="game-image">
                                        <p class="image-caption">Screenshot showing the 2×2 matrix multiplication
                                            interface</p>
                                    </div>

                                    <div class="image-container">
                                        <img src="img/matrix-game-04.png" alt="Matrix Game Screenshot 2"
                                            class="game-image">
                                        <p class="image-caption">Screenshot showing the memory game practice mode</p>
                                    </div>
                                </div>

                                <h3>How Teachers Can Use This Game</h3>
                                <ul>
                                    <li>Introduce matrix multiplication rules before solving numerical problems</li>
                                    <li>Demonstrate valid and invalid matrix combinations visually</li>
                                    <li>Help students understand why matrix multiplication order matters</li>
                                    <li>Engage students in quick rule-check activities during lessons</li>
                                </ul>

                                <h3>Suggested Classroom Scenarios</h3>
                                <ul>
                                    <li>Whole-class demonstration using the 2×2 mode for initial explanation</li>
                                    <li>Small group practice to reinforce rule recognition</li>
                                    <li>Warm-up or review activity before problem-solving sessions</li>
                                </ul>

                                <h3>Why This Game Works in Teaching</h3>
                                <ul>
                                    <li>Focuses on rules and structure rather than calculation</li>
                                    <li>Reduces cognitive load for students new to matrices</li>
                                    <li>Provides immediate visual feedback</li>
                                    <li>No setup or prior training required</li>
                                </ul>

                                <p>By separating rule memorization from computation, teachers can help students build a
                                    stronger conceptual foundation in matrix multiplication and linear algebra.</p>
                            </div>
                        </main>

                        <div class="article-footer">
                            <p>Matrix Multiplication Game Educational Guide | Designed for Interactive Learning</p>
                            <p>© 2023 Matrix Learning Tools. All educational content is freely available for classroom
                                use.</p>
                        </div>
                    </div>
                    <!-- ===== SEO文章部分结束 ===== -->
                </div>

                <!-- 右侧边栏 -->
                <div class="right-sidebar">
                    <div class="question-box">
                        <h2>Do you enjoy learning math?</h2>
                        <button class="btn yes">Yes, I love math!</button>
                        <button class="btn no">Math is challenging for me</button>
                        <div class="response" id="response"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚部分 -->
    <footer>
        <div class="container">
            <p>&copy; 2026 NDED - Building Mathematical Confidence for Life. All rights reserved.</p>
        </div>
    </footer>

    <!-- 3x3游戏JavaScript代码 -->
    <script>
        /* ================== Audio Manager ================== */
        const AudioManager = {
            enabled: true,
            sounds: {},

            init() {
                // 读取本地存储状态
                const saved = localStorage.getItem('matrix_game_sound');
                if (saved !== null) {
                    this.enabled = saved === 'true';
                }

                // 创建音频对象
                this.sounds.correct = new Audio('assets/audio/correct.mp3');
                this.sounds.wrong = new Audio('assets/audio/wrong.mp3');
                this.sounds.complete = new Audio('assets/audio/complete.mp3');

                Object.values(this.sounds).forEach(sound => {
                    sound.volume = 0.6;
                });

                this.updateUI();
            },

            play(name) {
                if (!this.enabled) return;
                const sound = this.sounds[name];
                if (!sound) return;

                sound.currentTime = 0;
                sound.play().catch(() => { });
            },

            toggle() {
                this.enabled = !this.enabled;
                localStorage.setItem('matrix_game_sound', this.enabled);
                this.updateUI();
            },

            updateUI() {
                const btn = document.getElementById('soundToggleBtn');
                if (!btn) return;

                if (this.enabled) {
                    btn.innerText = '🔊';
                    btn.classList.remove('muted');
                } else {
                    btn.innerText = '🔇';
                    btn.classList.add('muted');
                }
            }
        };
        /* ================== End Audio Manager ================== */

        // 1. 游戏状态 - 包含完整的拖拽状态
        let game = {
            level: 0,
            solved: 0,
            target: null,
            dragged: null,
            // 拖拽状态
            isDragging: false,
            dragStartX: 0,
            dragStartY: 0,
            dragClone: null,
            currentSlotHover: null,
            // 性能优化相关
            slotRects: [], // 预缓存的slot矩形数据
            requestFrameId: null, // requestAnimationFrame ID

            // 【新增】拖拽位置和偏移量（用于精确跟踪）
            dragX: 0,
            dragY: 0,
            touchOffsetX: 0,  // 点击位置相对于元素左上角的水平偏移
            touchOffsetY: 0,  // 点击位置相对于元素左上角的垂直偏移
            draggedCellWidth: 0,
            draggedCellHeight: 0,

            // 【新增】练习模式标志
            practiceMode: false
        };

        const levelData = ["Intro (Letters)", "Intermediate (Mixed)", "Advanced (Numbers)"];

        // 2. 页面加载后初始化
        document.addEventListener('DOMContentLoaded', function () {
            // 【修改】删除本地记忆功能，直接初始化游戏
            game.level = 0;
            game.solved = 0;
            game.practiceMode = false;

            initEvents();
            AudioManager.init();

            // 添加音效开关按钮点击事件
            document.getElementById('soundToggleBtn')
                .addEventListener('click', function () {
                    AudioManager.toggle();
                });
        });

        // 3. 初始化事件（统一使用Pointer Events）
        function initEvents() {
            const cells = document.querySelectorAll('#matA .cell, #matB .cell');
            const slots = document.querySelectorAll('.slot');

            // 移除所有现有的拖拽属性
            cells.forEach(cell => {
                cell.removeAttribute('draggable');
            });

            console.log("启用统一Pointer Events拖拽");
            initUnifiedDrag(cells, slots);
        }

        // 4. 统一拖拽实现（使用Pointer Events）
        function initUnifiedDrag(cells, slots) {
            cells.forEach(cell => {
                // Pointer Events事件监听
                cell.addEventListener('pointerdown', function (e) {
                    if (!game.target) return;

                    e.preventDefault();
                    e.stopPropagation();

                    game.isDragging = true;
                    game.dragged = cell;
                    game.dragStartX = e.clientX;
                    game.dragStartY = e.clientY;

                    // 在pointerdown时预缓存所有slot的矩形数据
                    cacheSlotRects(slots);

                    // 【关键修改】创建拖拽克隆（函数内部会计算偏移量）
                    createDragClone(cell, e.clientX, e.clientY);
                    cell.classList.add('selected');

                    // 设置指针捕获，确保后续事件被正确接收
                    cell.setPointerCapture(e.pointerId);

                    // 开始rAF更新循环
                    startDragUpdate();
                });

                // 防止默认的触摸行为
                cell.addEventListener('touchstart', function (e) {
                    if (game.target) e.preventDefault();
                }, { passive: false });
            });

            // 全局pointermove事件（使用事件委托提高性能）
            document.addEventListener('pointermove', function (e) {
                if (!game.isDragging || !game.dragged) return;

                e.preventDefault();
                e.stopPropagation();

                // 【关键修改】更新拖拽位置，考虑点击偏移量
                game.dragX = e.clientX - game.touchOffsetX;
                game.dragY = e.clientY - game.touchOffsetY;

                // 检查slot悬停（使用预缓存的矩形数据）
                checkSlotHoverWithCache(e.clientX, e.clientY);
            });

            // 全局pointerup事件
            document.addEventListener('pointerup', function (e) {
                if (!game.isDragging || !game.dragged) return;

                e.preventDefault();
                e.stopPropagation();

                // 完成拖拽
                finishDrag(e.clientX, e.clientY);
                cleanupDrag();
            });

            // 防止意外取消
            document.addEventListener('pointercancel', function () {
                if (game.isDragging) {
                    cleanupDrag();
                }
            });

            // 为slot添加事件
            slots.forEach(slot => {
                slot.addEventListener('pointerdown', function (e) {
                    if (game.isDragging) e.preventDefault();
                });

                slot.addEventListener('pointerup', function (e) {
                    if (game.isDragging && game.dragged && game.currentSlotHover === slot) {
                        e.preventDefault();
                        handleDropOnSlot(slot);
                        cleanupDrag();
                    }
                });
            });
        }

        // 5. 预缓存slot矩形数据
        function cacheSlotRects(slots) {
            game.slotRects = [];
            slots.forEach(slot => {
                const rect = slot.getBoundingClientRect();
                game.slotRects.push({
                    element: slot,
                    left: rect.left,
                    top: rect.top,
                    right: rect.right,
                    bottom: rect.bottom,
                    width: rect.width,
                    height: rect.height
                });
            });
        }

        // 6. 使用缓存的矩形数据检测悬停
        function checkSlotHoverWithCache(x, y) {
            if (game.currentSlotHover) {
                game.currentSlotHover.classList.remove('hover');
                game.currentSlotHover = null;
            }

            // 使用缓存的矩形数据进行数学计算，避免DOM查询
            for (const slotData of game.slotRects) {
                if (x >= slotData.left && x <= slotData.right &&
                    y >= slotData.top && y <= slotData.bottom) {
                    game.currentSlotHover = slotData.element;
                    slotData.element.classList.add('hover');
                    break;
                }
            }
        }

        // 7. 创建拖拽克隆函数（完全重写）
        function createDragClone(cell, x, y) {
            if (game.dragClone) game.dragClone.remove();

            game.dragClone = cell.cloneNode(true);
            game.dragClone.classList.add('drag-clone');

            // 【关键修改】获取方块在屏幕上的确切位置
            const rect = cell.getBoundingClientRect();

            // 【关键修改】计算"点击偏移量" - 鼠标/手指点击位置相对于元素左上角的偏移
            game.touchOffsetX = x - rect.left;
            game.touchOffsetY = y - rect.top;

            // 【关键修改】记录被拖拽元素的尺寸
            game.draggedCellWidth = rect.width;
            game.draggedCellHeight = rect.height;

            // 【关键修改】确保CSS基础位置归零，防止其他样式干扰
            game.dragClone.style.position = 'fixed';
            game.dragClone.style.top = '0';
            game.dragClone.style.left = '0';
            game.dragClone.style.margin = '0';
            game.dragClone.style.width = `${rect.width}px`;
            game.dragClone.style.height = `${rect.height}px`;

            // 【关键修改】计算初始位置
            game.dragX = x - game.touchOffsetX;
            game.dragY = y - game.touchOffsetY;

            // 初始渲染
            updateDragCloneTransform();

            document.body.appendChild(game.dragClone);
        }

        // 8. 更新拖拽克隆位置
        function updateDragCloneTransform() {
            if (!game.dragClone) return;

            // 【关键修改】使用计算好的dragX和dragY，确保精确跟随
            game.dragClone.style.transform = `translate3d(${game.dragX}px, ${game.dragY}px, 0) scale(1.1)`;
        }

        // 9. rAF更新循环
        function startDragUpdate() {
            if (game.requestFrameId) {
                cancelAnimationFrame(game.requestFrameId);
            }

            function update() {
                if (!game.isDragging || !game.dragClone) {
                    return;
                }

                // 【关键修改】更新拖拽克隆的位置
                updateDragCloneTransform();

                // 继续下一帧更新
                game.requestFrameId = requestAnimationFrame(update);
            }

            // 启动更新循环
            game.requestFrameId = requestAnimationFrame(update);
        }

        function finishDrag(x, y) {
            // 使用缓存的矩形数据检测放置目标
            for (const slotData of game.slotRects) {
                if (x >= slotData.left && x <= slotData.right &&
                    y >= slotData.top && y <= slotData.bottom) {
                    handleDropOnSlot(slotData.element);
                    break;
                }
            }
        }

        function handleDropOnSlot(slot) {
            if (!game.target || !game.dragged) return;
            processDrop(slot, game.dragged);
        }

        // 10. 放置处理函数（支持3x3矩阵的6个插槽）
        function processDrop(slot, draggedCell) {
            const idx = parseInt(slot.dataset.idx);
            const r = parseInt(draggedCell.dataset.r), c = parseInt(draggedCell.dataset.c);
            const isA = draggedCell.parentNode.id === 'matA';

            let ok = false;
            if (idx === 0) ok = (isA && r === game.target.r && c === 0);
            if (idx === 1) ok = (!isA && r === 0 && c === game.target.c);
            if (idx === 2) ok = (isA && r === game.target.r && c === 1);
            if (idx === 3) ok = (!isA && r === 1 && c === game.target.c);
            if (idx === 4) ok = (isA && r === game.target.r && c === 2);
            if (idx === 5) ok = (!isA && r === 2 && c === game.target.c);

            if (ok && !slot.classList.contains('filled')) {
                AudioManager.play('correct');

                slot.innerText = draggedCell.innerText;
                slot.classList.add('filled');
                slot.style.backgroundColor = isA ? 'var(--clay-primary)' : 'var(--clay-accent-yellow)';
                slot.style.borderColor = isA ? 'var(--clay-primary)' : 'var(--clay-accent-yellow)';
                game.target.count++;
                if (game.target.count === 6) {
                    AudioManager.play('correct');
                    finishTask();
                }

                slot.classList.remove('hover');
            } else {
                AudioManager.play('wrong');
            }
        }

        function cleanupDrag() {
            game.isDragging = false;

            // 停止rAF更新循环
            if (game.requestFrameId) {
                cancelAnimationFrame(game.requestFrameId);
                game.requestFrameId = null;
            }

            if (game.dragClone) {
                game.dragClone.remove();
                game.dragClone = null;
            }

            if (game.dragged) {
                game.dragged.classList.remove('selected');
            }

            if (game.currentSlotHover) {
                game.currentSlotHover.classList.remove('hover');
                game.currentSlotHover = null;
            }

            // 清空缓存
            game.slotRects = [];
            game.dragged = null;
        }

        // 11. 游戏核心函数（修复选中状态问题）
        function initTask(r, c, el) {
            // 【新增】如果游戏已经完成，不执行任何操作
            if (game.level >= 3 && !game.practiceMode) return;

            if (el.classList.contains('done')) return;

            // 【关键修复】清除所有结果矩阵单元格的选中状态
            document.querySelectorAll('#matC .cell').forEach(cell => {
                cell.classList.remove('selected');
            });

            // 【关键修复】为当前点击的单元格添加选中状态
            el.classList.add('selected');

            game.target = { r, c, el, count: 0 };
            document.getElementById('hintText').style.display = 'none';

            // 【关键修复】只清除矩阵A和B的单元格状态，不包含矩阵C
            document.querySelectorAll('#matA .cell, #matB .cell').forEach(c => {
                c.classList.remove('highlight');
                c.classList.remove('selected');
            });

            document.querySelectorAll('.slot').forEach(s => {
                s.classList.remove('hover');
            });
            document.getElementById('dock').classList.add('show');
            document.getElementById('solveBtn').style.display = 'block'; // 显示Quick Solve按钮
            document.querySelectorAll('.slot').forEach(s => {
                s.innerText = '?';
                s.className = s.classList.contains('slot-a') ? 'slot slot-a' : 'slot slot-b';
                s.style.backgroundColor = "";
                s.style.borderColor = "";
                s.classList.remove('filled');
            });

            document.querySelectorAll('#matA .cell').forEach(cell => {
                if (parseInt(cell.dataset.r) === r) cell.classList.add('highlight');
            });
            document.querySelectorAll('#matB .cell').forEach(cell => {
                if (parseInt(cell.dataset.c) === c) cell.classList.add('highlight');
            });
        }

        function finishTask() {
            // 【新增】安全检查
            if (!game.target || !game.target.el) {
                console.log("游戏目标不存在，安全退出");
                return;
            }

            const t = game.target;

            // 【新增】确保元素没有完成过
            if (t.el.classList.contains('done')) {
                return;
            }

            // 【关键修复】移除选中状态，添加完成状态
            t.el.classList.remove('selected');
            t.el.classList.add('done');

            // 如果是练习模式或第三关，计算数值结果
            if (game.level === 2 || game.practiceMode) {
                const s = Array.from(document.querySelectorAll('.slot')).map(x => parseInt(x.innerText) || 0);
                t.el.innerText = (s[0] * s[1]) + (s[2] * s[3]) + (s[4] * s[5]);
            } else {
                t.el.innerText = "✓";
            }

            document.getElementById('dock').classList.remove('show');
            document.getElementById('solveBtn').style.display = 'none'; // 隐藏Quick Solve按钮

            cleanupDrag();

            game.solved++;

            // 【修改】根据是否练习模式决定完成后的行为
            if (game.solved === 9) {
                if (!game.practiceMode) {
                    // 正常模式：增加关卡并显示相应弹窗
                    game.level++;

                    document.getElementById('s' + game.level).classList.add('active');
                    if (game.level < 3) {
                        showSuccess();
                    } else {
                        victory();
                    }
                } else {
                    // 练习模式：直接重置游戏，不弹出胜利弹窗
                    setTimeout(function () {
                        setupNext();
                    }, 500);
                }
            }
        }

        function showSuccess() {
            // 播放关卡完成音效
            AudioManager.play('complete');

            document.getElementById('noticeTitle').innerText = "Level " + game.level + " Cleared!";
            document.getElementById('noticeBody').innerText = "Your matrix skills are growing.";

            // 隐藏第三关特有的元素，显示常规继续按钮
            document.getElementById('practiceText').style.display = 'none';
            document.getElementById('matrixCalcBtn').style.display = 'none';
            document.getElementById('morePracticeBtn').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'inline-flex';
            document.getElementById('continueBtn').innerText = "Continue ➡";

            document.getElementById('miniNotice').style.display = 'block';
        }

        function victory() {
            // 播放最终胜利音效
            AudioManager.play('complete');

            document.getElementById('noticeTitle').innerText = "🏆 Grand Master!";
            document.getElementById('noticeBody').innerText = "You have fully mastered 3x3 Matrix Multiplication!";
            document.getElementById('practiceText').innerText = "Congratulations! You've mastered 3x3 matrix multiplication!";

            // 【修改】在第三关胜利时显示额外的提示和Matrix Calculator按钮，以及新增的More Practice按钮
            document.getElementById('practiceText').style.display = 'block';
            document.getElementById('matrixCalcBtn').style.display = 'inline-flex';
            document.getElementById('morePracticeBtn').style.display = 'inline-flex';
            document.getElementById('continueBtn').style.display = 'none'; // 隐藏常规继续按钮

            document.getElementById('miniNotice').style.display = 'block';
            document.getElementById('masterPanel').style.display = 'flex';
            document.getElementById('statusLabel').innerText = "Course Completed - Great Job!";
        }

        function closeNotice() {
            document.getElementById('miniNotice').style.display = 'none';

            // 【修改】清除所有结果矩阵单元格的选中状态
            document.querySelectorAll('#matC .cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });

            // 【修改】无论什么关卡都调用setupNext，确保游戏可以循环
            setupNext();
        }

        // 【新增】开始更多练习函数
        function startMorePractice() {
            // 关闭弹窗
            document.getElementById('miniNotice').style.display = 'none';

            // 设置为练习模式
            game.practiceMode = true;

            // 重置游戏为第三关数字模式
            game.level = 2; // 设置为第三关
            game.solved = 0;

            // 更新状态标签
            document.getElementById('statusLabel').innerText = "Practice Mode: Advanced (Numbers)";

            // 设置矩阵为随机数字
            document.querySelectorAll('#matA .cell, #matB .cell').forEach(cell => {
                if (cell.parentNode.id !== 'matC') {
                    cell.innerText = Math.floor(Math.random() * 9) + 1;
                }
            });

            // 【关键修复】重置结果矩阵，清除选中状态
            document.querySelectorAll('#matC .cell').forEach(c => {
                c.innerText = '?';
                c.className = 'cell'; // 这会移除所有类名，包括selected和done
            });

            // 重置星星显示（练习模式不显示星星进度）
            document.getElementById('s1').classList.remove('active');
            document.getElementById('s2').classList.remove('active');
            document.getElementById('s3').classList.remove('active');

            // 显示主面板（包含Restart Training和Matrix Calculator按钮）
            document.getElementById('masterPanel').style.display = 'flex';

            // 更新提示文本
            document.getElementById('hintText').innerText = "Practice Mode: Solve as many problems as you like!";
            document.getElementById('hintText').style.display = 'block';
        }

        function setupNext() {
            // 【修改】如果完成所有关卡且不是练习模式，重置游戏到第一关
            if (game.level >= 3 && !game.practiceMode) {
                game.level = 0;
                game.solved = 0;
                game.practiceMode = false;

                // 重置星星
                document.getElementById('s1').classList.remove('active');
                document.getElementById('s2').classList.remove('active');
                document.getElementById('s3').classList.remove('active');

                // 隐藏主面板
                document.getElementById('masterPanel').style.display = 'none';
            }

            game.solved = 0;

            // 根据是否练习模式更新状态标签
            if (game.practiceMode) {
                document.getElementById('statusLabel').innerText = "Practice Mode: Advanced (Numbers)";
            } else {
                document.getElementById('statusLabel').innerText = "3x3 Matrix: Level " + (game.level + 1);
            }

            // 【关键修复】清除所有结果矩阵单元格的状态，包括选中状态
            document.querySelectorAll('#matC .cell').forEach(c => {
                c.innerText = '?';
                c.className = 'cell'; // 这会移除所有类名，包括selected和done
            });

            // 如果是第三关或练习模式，设置矩阵为数字
            if (game.level === 2 || game.practiceMode) {
                document.querySelectorAll('#matA .cell, #matB .cell').forEach(cell => {
                    if (cell.parentNode.id !== 'matC') {
                        cell.innerText = Math.floor(Math.random() * 9) + 1;
                    }
                });
            }
        }

        function autoFill() {
            if (!game.target) return;

            // 【新增】安全检查
            if (!game.target.el) return;

            const r = game.target.r, c = game.target.c;
            const cellsA = Array.from(document.querySelectorAll('#matA .cell'));
            const cellsB = Array.from(document.querySelectorAll('#matB .cell'));
            const slots = document.querySelectorAll('.slot');
            slots[0].innerText = cellsA[r * 3].innerText;
            slots[1].innerText = cellsB[c].innerText;
            slots[2].innerText = cellsA[r * 3 + 1].innerText;
            slots[3].innerText = cellsB[c + 3].innerText;
            slots[4].innerText = cellsA[r * 3 + 2].innerText;
            slots[5].innerText = cellsB[c + 6].innerText;
            finishTask();
        }

        // 防止全局触摸事件干扰
        document.addEventListener('touchmove', function (e) {
            if (game.isDragging) e.preventDefault();
        }, { passive: false });
    </script>

    <!-- 模板JavaScript代码 -->
    <script>
        // 问答栏功能
        function initPoll() {
            const yesBtn = document.querySelector('.question-box .yes');
            const noBtn = document.querySelector('.question-box .no');
            const response = document.getElementById('response');

            yesBtn.addEventListener('click', () => {
                response.textContent = "That's great! Math is an amazing tool for understanding the world! 🧮";
                response.classList.add('show');
            });

            noBtn.addEventListener('click', () => {
                response.textContent = "We're here to help! Our resources are designed to make math easier and more fun. 👍";
                response.classList.add('show');
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // 初始化问答栏
            initPoll();
        });
    </script>
</body>

</html>