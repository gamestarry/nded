<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Matrix Weaver - An interactive game to learn matrix multiplication rules. Practice with letters and numbers to build mathematical confidence.">
    <meta name="keywords"
        content="matrix multiplication, math game, matrix calculator, mathematics, education, learning game">
    <meta name="author" content="NDED">
    <title>Matrix Weaver - Learn Matrix Multiplication | NDED</title>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts for NDED styling -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@800;900&family=Raleway:wght@400;500&family=Quicksand:wght@400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="canonical" href="https://www.nd-ed.org/matrix-multiplication-by-2-game.html">

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #8a2be2;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

            /* æ¸¸æˆé»åœŸé£æ ¼å˜é‡ */
            --clay-bg: #E0E9FF;
            --clay-primary: #6B94FF;
            --clay-accent-pink: #FF99C8;
            --clay-accent-yellow: #FFD152;
            --clay-success: #10B981;
            --clay-selected: #6ED6A7;
            /* æ–°å¢ï¼šé€‰ä¸­çŠ¶æ€é¢œè‰²ï¼ˆæµ…ç»¿è‰²ï¼‰ */
            --clay-purple: #A78BFA;
            --clay-dark-bg: #0A1931;
            --clay-gray: #94A3B8;
            --clay-shadow:
                8px 8px 16px rgba(0, 0, 0, 0.1),
                -4px -4px 12px rgba(255, 255, 255, 0.8),
                inset 4px 4px 8px rgba(255, 255, 255, 0.4),
                inset -4px -4px 8px rgba(0, 0, 0, 0.05);
            --clay-radius-lg: 30px;
            --clay-radius-sm: 12px;
            --text-dark: #2D3748;
            --text-light: #4A5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ä¸»è¡Œå¸ƒå±€å®¹å™¨ */
        .main-row-container {
            width: 100%;
            background-color: #f9f9f9;
            padding: 0 0 1.5rem 0;
            position: relative;
            z-index: 1;
        }

        /* æ›´å®½çš„å®¹å™¨ï¼Œç”¨äºå®¹çº³ä¸‰ä¸ªå¹¶æ’çš„éƒ¨åˆ† */
        .wide-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ä¸»è¡Œå¸ƒå±€ */
        .main-row {
            display: flex;
            gap: 1.5rem;
        }

        .left-sidebar,
        .right-sidebar {
            flex: 0 0 250px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.2rem;
            position: relative;
            z-index: 1;
        }

        .main-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        /* åŠ¨æ€å†…å®¹å®¹å™¨æ ·å¼ */
        .dynamic-content-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .dynamic-content-container h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
            border-bottom: none;
            padding-bottom: 0;
        }

        .dynamic-content-container p {
            color: var(--dark-color);
            text-align: center;
            max-width: 600px;
            margin: 0 auto 1.5rem;
        }

        /* å·¦ä¾§è¾¹æ çŸ©é˜µè®¡ç®—å™¨è¾¹æ¡† */
        .matrix-calc-banner {
            background: linear-gradient(135deg, var(--clay-primary) 0%, var(--clay-purple) 100%);
            border-radius: var(--clay-radius-sm);
            padding: 1rem;
            margin-top: 1.2rem;
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        .matrix-calc-banner h4 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 0.7rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .matrix-calc-button {
            display: inline-block;
            background: white;
            color: var(--clay-primary);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .matrix-calc-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            background: var(--clay-accent-yellow);
            color: var(--clay-dark-bg);
        }

        /* å·¦ä¾§å¯¼èˆªæ æ ·å¼ */
        .nav-title {
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-color);
            text-align: center;
        }

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .nav-button {
            background-color: var(--light-color);
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
            padding: 0.4rem 0.8rem;
            font-size: 0.95rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: block;
            font-weight: 500;
        }

        .nav-button:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-color: var(--secondary-color);
        }

        .nav-button:active {
            transform: translateY(0);
        }

        /* ä¸ºå¤–éƒ¨é“¾æ¥æŒ‰é’®æ·»åŠ å¤–é“¾æ ‡å¿— */
        .nav-button.external {
            position: relative;
            padding-right: 2.5rem;
            background-color: var(--light-color);
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
        }

        .nav-button.external::after {
            content: "â†—";
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .nav-button.external:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .nav-button.external:hover::after {
            transform: translateY(-50%) translateX(2px) translateY(-2px);
        }

        /* å¤´éƒ¨æ ·å¼ - å·²ä¿®æ”¹ï¼Œæ•´ä½“ç¼©å°10% */
        header {
            background: linear-gradient(135deg, #00447F 0%, #0066AA 100%);
            color: white;
            padding: 0.2rem 0;
            text-align: center;
            margin-bottom: 0.4rem;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: visible;
            display: flex;
            align-items: center;
            min-height: 72px;
            z-index: 1000;
            transform: scaleY(0.9);
            transform-origin: top;
        }

        /* æ·»åŠ å¾®å¦™çš„çº¹ç†æ•ˆæœ */
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }

        /* æ–°çš„æ ‡é¢˜æ ·å¼ - ç¼©å°10% */
        .main-title {
            font-size: 2.3rem;
            margin-bottom: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            line-height: 1.2;
            font-family: 'Raleway', sans-serif;
            font-weight: 500;
            display: flex;
            align-items: flex-end;
            flex-wrap: wrap;
            justify-content: center;
            transform: scale(0.9);
            transform-origin: center;
        }

        /* NDEDç‰¹æ®Šæ ·å¼ - ä¿®æ”¹ä¸ºå‘å†…å‡¹çš„åœ†è§’ï¼Œç¼©å°10% */
        .nded-text {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 900;
            font-size: 2.6rem;
            color: #2c3e50;
            letter-spacing: 0.4px;
            display: inline-block;
            position: relative;
            padding: 0 9px;
            margin-right: 6px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow:
                inset 2.5px 2.5px 4px rgba(0, 0, 0, 0.2),
                inset -2.5px -2.5px 4px rgba(255, 255, 255, 0.8),
                0 1.5px 3px rgba(0, 0, 0, 0.1);
            border: 0.8px solid rgba(0, 0, 0, 0.1);
            line-height: 1.1;
            height: 52px;
            display: inline-flex;
            align-items: center;
        }

        /* å‰¯æ ‡é¢˜æ ·å¼ - æ·»åŠ æ–°çš„æ ·å¼ï¼Œç¼©å°10% */
        .subtitle {
            font-size: 1.55rem;
            font-style: italic;
            color: #f0f0f0;
            text-shadow: 0.8px 0.8px 1.5px rgba(0, 0, 0, 0.3);
            font-weight: 400;
            margin-left: 6px;
            letter-spacing: 0.4px;
            line-height: 1.1;
            display: inline-flex;
            align-items: flex-end;
            height: 52px;
            position: relative;
        }

        /* ç»™NDEDæ·»åŠ è£…é¥°æ€§è¾¹æ¡†æ•ˆæœ */
        .nded-text::before {
            content: "";
            position: absolute;
            top: -2.5px;
            left: -2.5px;
            right: -2.5px;
            bottom: -2.5px;
            border: 0.8px solid rgba(255, 215, 0, 0.2);
            border-radius: 11.5px;
            z-index: -1;
        }

        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 0.4rem 0;
            margin-top: 2rem;
        }

        /* å³ä¾§è¾¹æ æ ·å¼ */
        .right-sidebar {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            min-height: 200px;
            padding: 1.2rem;
        }

        .right-sidebar-placeholder {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }

        /* é—®ç­”æ æ ·å¼ */
        .question-box {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            padding: 1.2em;
            width: 100%;
            transition: all 0.3s ease;
            font-family: "Poppins", "Nunito", sans-serif;
        }

        .question-box h2 {
            font-size: 0.95rem;
            margin-bottom: 1.2em;
            color: #333;
        }

        .question-box .btn {
            display: block;
            width: 100%;
            padding: 0.65em 0.8em;
            margin-bottom: 0.65em;
            border-radius: 10px;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .question-box .yes {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
        }

        .question-box .yes:hover {
            transform: scale(1.05);
            box-shadow: 0 3.6px 9px rgba(120, 100, 255, 0.3);
        }

        .question-box .no {
            background: #ffe7e7;
            color: #ff4b4b;
        }

        .question-box .no:hover {
            transform: rotate(-2deg) scale(1.05);
            box-shadow: 0 3.6px 9px rgba(255, 75, 75, 0.2);
        }

        .question-box .response {
            margin-top: 1.2em;
            font-size: 0.85rem;
            color: #555;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .question-box .response.show {
            opacity: 1;
        }

        /* æ¸¸æˆå®¹å™¨æ ·å¼ */
        .game-wrapper {
            background-color: var(--clay-bg);
            border-radius: var(--clay-radius-lg);
            padding: 12px;
            margin-top: -5px;
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            position: relative;
        }

        /* æ¸¸æˆæ ‡é¢˜ */
        .game-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--clay-dark-bg);
            text-align: center;
            margin: 0 0 8px 0;
            padding: 0 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
            font-family: 'Quicksand', sans-serif;
        }

        /* æ˜Ÿæ˜Ÿä¸çŠ¶æ€ - ç²˜åœŸé£æ ¼ */
        .stars-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: center;
            margin: 0 auto 5px;
        }

        .stars-row {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .star {
            font-size: 2.2rem;
            color: rgba(107, 148, 255, 0.2);
            transition: 0.3s;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .star.active {
            color: var(--clay-accent-yellow);
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(255, 209, 82, 0.3));
        }

        .status-container {
            text-align: center;
            margin-bottom: 12px;
            max-width: 100%;
            background: rgba(255, 255, 255, 0.7);
            padding: 8px 12px;
            border-radius: var(--clay-radius-lg);
            box-shadow: var(--clay-shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin: 0 auto 12px;
        }

        .status-label {
            font-weight: 700;
            color: var(--clay-dark-bg);
            font-size: 1rem;
            display: block;
            margin-bottom: 5px;
            font-family: 'Quicksand', sans-serif;
        }

        .hint-text {
            font-size: 0.85rem;
            color: var(--clay-primary);
            font-style: italic;
            margin-top: 5px;
            animation: pulse 2s infinite;
            display: block;
            font-weight: 500;
            font-family: 'Quicksand', sans-serif;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* è¿·ä½ é€šçŸ¥ - ç²˜åœŸé£æ ¼ */
        #miniNotice {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: var(--clay-radius-lg);
            box-shadow: var(--clay-shadow);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            border: 2px solid var(--clay-primary);
            text-align: center;
            backdrop-filter: blur(20px);
            max-width: 350px;
            width: 90%;
        }

        /* æ ¸å¿ƒ Playground - ç²˜åœŸå®¹å™¨ */
        .playground {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: var(--clay-radius-lg);
            box-shadow: var(--clay-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border: 2px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            margin-bottom: 12px;
        }

        /* çŸ©é˜µå®¹å™¨ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .matrices {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* çŸ©é˜µè¡Œå®¹å™¨ - æ–°å¢ï¼šç”¨äºç§»åŠ¨ç«¯çš„ä¸¤è¡Œå¸ƒå±€ */
        .matrix-row {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 6px;
            flex-wrap: wrap;
        }

        /* çŸ©é˜µ - ç²˜åœŸé£æ ¼ */
        .matrix {
            display: grid;
            grid-template-columns: repeat(2, 60px);
            gap: 8px;
            padding: 10px;
            flex-shrink: 0;
        }

        /* å•å…ƒæ ¼ - ç²˜åœŸè´¨æ„Ÿ */
        .cell {
            width: 60px;
            height: 60px;
            border-radius: var(--clay-radius-sm);
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.2s;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            cursor: pointer;
            box-shadow: var(--clay-shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: var(--text-dark);
            font-family: 'Quicksand', sans-serif;
        }

        /* çŸ©é˜µAå’ŒçŸ©é˜µBçš„åˆå§‹é¢œè‰²ä¸ºç™½è‰² */
        #matA .cell,
        #matB .cell {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-dark);
        }

        /* ç‚¹å‡»ç»“æœçŸ©é˜µåï¼ŒçŸ©é˜µAé«˜äº®ä¸ºè“è‰² */
        #matA .cell.highlight {
            background: var(--clay-primary);
            color: white;
            box-shadow:
                8px 8px 16px rgba(0, 0, 0, 0.15),
                -4px -4px 12px rgba(255, 255, 255, 0.9),
                inset 4px 4px 8px rgba(255, 255, 255, 0.6);
        }

        /* ç‚¹å‡»ç»“æœçŸ©é˜µåï¼ŒçŸ©é˜µBé«˜äº®ä¸ºé»„è‰² */
        #matB .cell.highlight {
            background: var(--clay-accent-yellow);
            color: var(--clay-dark-bg);
            box-shadow:
                8px 8px 16px rgba(0, 0, 0, 0.15),
                -4px -4px 12px rgba(255, 255, 255, 0.9),
                inset 4px 4px 8px rgba(255, 255, 255, 0.6);
        }

        /* ç»“æœçŸ©é˜µåˆå§‹çŠ¶æ€ */
        #matC .cell {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-light);
            cursor: pointer;
            border: 2px dashed rgba(107, 148, 255, 0.3);
            position: relative;
        }

        /* è®¡ç®—å®Œæˆåï¼Œç»“æœçŸ©é˜µå˜ä¸ºæ·±ç»¿è‰² */
        #matC .cell.done {
            background: var(--clay-success);
            color: white;
            border: none;
            cursor: default;
            box-shadow: var(--clay-shadow);
        }

        /* æ–°å¢ï¼šç»“æœçŸ©é˜µå•å…ƒæ ¼é€‰ä¸­çŠ¶æ€ï¼ˆæµ…ç»¿è‰²ï¼‰ */
        #matC .cell.selected {
            background: var(--clay-selected);
            color: var(--clay-dark-bg);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow:
                0 0 0 3px rgba(110, 214, 167, 0.4),
                8px 8px 16px rgba(0, 0, 0, 0.1),
                -4px -4px 12px rgba(255, 255, 255, 0.8),
                inset 4px 4px 8px rgba(255, 255, 255, 0.6);
            font-weight: 800;
            animation: pulse-selected 1.5s infinite alternate;
            position: relative;
        }

        /* é€‰ä¸­çŠ¶æ€è„‰å†²åŠ¨ç”» */
        @keyframes pulse-selected {
            0% {
                box-shadow:
                    0 0 0 3px rgba(110, 214, 167, 0.3),
                    8px 8px 16px rgba(0, 0, 0, 0.1),
                    -4px -4px 12px rgba(255, 255, 255, 0.8),
                    inset 4px 4px 8px rgba(255, 255, 255, 0.6);
            }

            100% {
                box-shadow:
                    0 0 0 3px rgba(110, 214, 167, 0.6),
                    8px 8px 16px rgba(0, 0, 0, 0.1),
                    -4px -4px 12px rgba(255, 255, 255, 0.8),
                    inset 4px 4px 8px rgba(255, 255, 255, 0.6);
            }
        }

        /* å¯é€‰ï¼šåœ¨é€‰ä¸­çŠ¶æ€çš„å•å…ƒæ ¼ä¸­æ·»åŠ ä¸€ä¸ªå°å›¾æ ‡ */
        #matC .cell.selected::after {
            content: "â†»";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            opacity: 0.8;
        }

        /* å®ŒæˆçŠ¶æ€çš„å•å…ƒæ ¼å¯ä»¥æ·»åŠ å¯¹å‹¾ */
        #matC .cell.done::after {
            content: "âœ“";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* ç»“æœçŸ©é˜µå•å…ƒæ ¼ç‚¹å‡»åŠ¨ç”» */
        #matC .cell:active {
            transform: scale(0.95);
            box-shadow:
                4px 4px 8px rgba(0, 0, 0, 0.1),
                -2px -2px 6px rgba(255, 255, 255, 0.8),
                inset 2px 2px 4px rgba(255, 255, 255, 0.4);
            transition: all 0.1s ease;
        }

        /* ç§»åŠ¨ç«¯é€‰ä¸­çŠ¶æ€ */
        .cell.selected {
            outline: 3px solid var(--clay-primary);
            transform: scale(1.05);
            z-index: 10;
            box-shadow:
                12px 12px 24px rgba(0, 0, 0, 0.15),
                -6px -6px 16px rgba(255, 255, 255, 0.9),
                inset 6px 6px 10px rgba(255, 255, 255, 0.6);
        }

        /* æ‹–æ‹½å…‹éš†å…ƒç´  - ä¼˜åŒ–GPUåŠ é€Ÿ */
        .drag-clone {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.8;
            transform: scale(1.1);
            transition: none !important;
            will-change: transform;
            box-shadow:
                0 15px 35px rgba(0, 0, 0, 0.25),
                -6px -6px 20px rgba(255, 255, 255, 0.8);
        }

        /* è¿ç®—ç¬¦ */
        .operator {
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--clay-primary);
            flex-shrink: 0;
            margin: 0 3px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            font-family: 'Quicksand', sans-serif;
        }

        /* å…¬å¼æ’æ§½åŒºåŸŸ */
        .formula-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 100%;
        }

        /* å…¬å¼æ’æ§½å’ŒæŒ‰é’®å®¹å™¨ */
        .formula-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            width: 100%;
        }

        .dock {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50px;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
            flex-wrap: wrap;
            justify-content: center;
            box-shadow: var(--clay-shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            flex-shrink: 0;
        }

        .dock.show {
            opacity: 1;
            pointer-events: all;
        }

        .slot {
            width: 40px;
            height: 40px;
            border-radius: var(--clay-radius-sm);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            background: white;
            transition: all 0.2s;
            box-shadow: var(--clay-shadow);
            color: var(--text-dark);
            font-size: 0.95rem;
            font-family: 'Quicksand', sans-serif;
        }

        /* çŸ©é˜µAå¯¹åº”çš„æ’æ§½è¾¹æ¡†ä¸ºè“è‰² */
        .slot-a {
            border: 2px dashed var(--clay-primary);
            background: rgba(107, 148, 255, 0.1);
        }

        /* çŸ©é˜µBå¯¹åº”çš„æ’æ§½è¾¹æ¡†ä¸ºé»„è‰² */
        .slot-b {
            border: 2px dashed var(--clay-accent-yellow);
            background: rgba(255, 209, 82, 0.1);
        }

        .slot.filled {
            border-style: solid;
            color: var(--clay-dark-bg);
        }

        .slot.hover {
            transform: scale(1.1);
            border-width: 3px;
            background-color: rgba(107, 148, 255, 0.2);
        }

        /* Solve CurrentæŒ‰é’® */
        #solveBtn {
            padding: 8px 16px;
            border-radius: var(--clay-radius-sm);
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
            color: white;
            touch-action: manipulation;
            box-shadow: var(--clay-shadow);
            background: var(--clay-success);
            white-space: nowrap;
            display: none;
            font-family: 'Quicksand', sans-serif;
        }

        #solveBtn:hover {
            transform: translateY(-2px);
            box-shadow:
                12px 12px 24px rgba(0, 0, 0, 0.12),
                -6px -6px 16px rgba(255, 255, 255, 0.9),
                inset 4px 4px 8px rgba(255, 255, 255, 0.6);
        }

        /* åº•éƒ¨å·¥å…·æ  - ç²˜åœŸæŒ‰é’® */
        .tools-area {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            padding-bottom: 10px;
            margin: 0 auto;
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--clay-radius-sm);
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
            color: white;
            touch-action: manipulation;
            box-shadow: var(--clay-shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
            font-family: 'Quicksand', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow:
                12px 12px 24px rgba(0, 0, 0, 0.12),
                -6px -6px 16px rgba(255, 255, 255, 0.9),
                inset 4px 4px 8px rgba(255, 255, 255, 0.6);
        }

        /* Quick SolveæŒ‰é’® */
        .btn-green {
            background: var(--clay-success);
        }

        /* Advance to 3x3æŒ‰é’® */
        .btn-blue {
            background: var(--clay-purple);
        }

        /* Restart TrainingæŒ‰é’® */
        .btn-gray {
            background: var(--clay-gray);
        }

        .btn-link {
            background: var(--clay-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            color: white;
        }

        /* ================== éŸ³æ•ˆæ§åˆ¶æŒ‰é’®æ ·å¼ ================== */
        .sound-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .sound-toggle-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--clay-primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--clay-shadow);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .sound-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow:
                12px 12px 24px rgba(0, 0, 0, 0.15),
                -6px -6px 16px rgba(255, 255, 255, 0.9);
        }

        .sound-toggle-btn.muted {
            background: var(--clay-gray);
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .sound-controls {
                top: 15px;
                right: 15px;
            }

            .sound-toggle-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            .sound-controls {
                top: 10px;
                right: 10px;
            }

            .sound-toggle-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }

        /* ================== SEOæ–‡ç« æ ·å¼ ================== */
        .seo-article-container {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .seo-article {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            line-height: 1.6;
        }

        .seo-article * {
            box-sizing: border-box;
        }

        .seo-article header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a6fa5;
            background: none;
            box-shadow: none;
            border-radius: 0;
            color: inherit;
            min-height: auto;
            transform: none;
            padding: 0;
        }

        .seo-article h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4a6fa5, #166088);
            -webkit-background-clip: text;
            white-space: nowrap;
            background-clip: text;
            color: transparent;
            text-align: center;
            border-bottom: none;
            padding-bottom: 0;
        }

        .seo-article .subtitle {
            color: #7b8a8b;
            font-size: 1.1rem;
            font-weight: 400;
        }

        .seo-article h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin: 25px 0 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #eaeaea;
        }

        .seo-article h3 {
            color: #3498db;
            font-size: 1.4rem;
            margin: 18px 0 8px;
        }

        .seo-article p {
            margin-bottom: 14px;
            font-size: 1rem;
            color: #444;
        }

        .seo-article ul,
        .seo-article ol {
            margin-left: 20px;
            margin-bottom: 18px;
        }

        .seo-article li {
            margin-bottom: 6px;
            padding-left: 5px;
        }

        .seo-article .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 18px;
        }

        .seo-article .section-number {
            background-color: #4a6fa5;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 12px;
        }

        .seo-article .gameplay-steps {
            background-color: #f1f8ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .seo-article .gameplay-steps h3 {
            color: #2c3e50;
            margin-top: 0;
        }

        .seo-article .step {
            display: flex;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #d1e3f6;
        }

        .seo-article .step:last-child {
            border-bottom: none;
        }

        .seo-article .step-number {
            background-color: #3498db;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .seo-article .tip-box {
            background-color: #fff8e1;
            border-radius: 10px;
            padding: 18px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
        }

        .seo-article .teacher-images {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 25px 0;
        }

        .seo-article .image-container {
            flex: 1;
            min-width: 280px;
            max-width: 450px;
            text-align: center;
        }

        /* å›¾ç‰‡æ ·å¼ - è¿™é‡Œæ§åˆ¶äº†å›¾ç‰‡å¤§å° */
        .seo-article .game-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 12px;
        }

        /* é¼ æ ‡æ‚¬åœæ•ˆæœ - å¯é€‰ */
        .seo-article .game-image:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .seo-article .image-caption {
            font-style: italic;
            color: #666;
            text-align: center;
            font-size: 0.9rem;
            padding: 0 8px;
        }

        .seo-article .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .seo-article .key-point {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            border-top: 4px solid #4a6fa5;
        }

        .seo-article .key-point h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .seo-article footer {
            text-align: center;
            margin-top: 35px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
            color: #7b8a8b;
            font-size: 0.85rem;
            background: none;
            padding: 0;
            margin: 35px 0 0 0;
        }

        @media (max-width: 768px) {
            .seo-article h1 {
                font-size: 2rem;
            }

            .seo-article h2 {
                font-size: 1.6rem;
            }

            .seo-article .teacher-images {
                flex-direction: column;
                align-items: center;
            }

            .seo-article .image-container {
                min-width: 100%;
            }

            .seo-article .game-image {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .seo-article .game-image {
                max-width: 100%;
            }

            .seo-article .teacher-images {
                gap: 15px;
            }
        }

        /* ================== å“åº”å¼ä¼˜åŒ– ================== */
        @media (max-width: 768px) {
            .main-row {
                flex-direction: column;
                gap: 1rem;
            }

            .left-sidebar,
            .right-sidebar {
                flex: 1;
                padding: 1rem !important;
            }

            .main-title {
                font-size: 1.6rem;
                flex-direction: column;
                align-items: center;
            }

            .nded-text {
                font-size: 1.8rem;
                margin-right: 0;
                margin-bottom: 4px;
                height: 40px;
                padding: 0 8px;
                border-radius: 8px;
            }

            .subtitle {
                font-size: 1.1rem;
                margin-left: 0;
                text-align: center;
                height: auto;
                line-height: 1.3;
                display: block;
                margin-top: 4px;
            }

            header {
                flex-direction: column;
                padding: 0.4rem 0;
                min-height: 90px;
                margin-bottom: 0.3rem;
            }

            .wide-container {
                padding: 0 10px !important;
            }

            .dynamic-content-container {
                padding: 1rem !important;
                margin-bottom: 1rem;
            }

            /* æ¸¸æˆå“åº”å¼è°ƒæ•´ */
            .game-wrapper {
                padding: 10px !important;
                border-radius: 20px;
                margin-top: -3px;
            }

            .game-title {
                font-size: 1.6rem;
                margin-bottom: 8px;
            }

            .playground {
                padding: 12px 8px !important;
                border-radius: 20px;
                gap: 10px;
                max-width: 95%;
                margin-bottom: 10px;
            }

            .matrices {
                flex-direction: column;
                gap: 8px;
                width: 100%;
                max-width: 280px;
                margin: 0 auto;
            }

            .matrix-row:first-child {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 5px;
                flex-wrap: nowrap;
                width: 100%;
            }

            .matrix-row:last-child {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 5px;
                flex-wrap: nowrap;
                width: 100%;
                margin-top: 6px;
            }

            .matrix {
                grid-template-columns: repeat(2, 50px) !important;
                gap: 6px;
                padding: 8px;
                margin: 0;
            }

            #matA,
            #matB {
                transform: scale(0.9);
                transform-origin: center;
            }

            #matC {
                transform: none;
            }

            .cell {
                width: 50px !important;
                height: 50px !important;
                font-size: 1.1rem;
                border-radius: 8px;
            }

            /* ç§»åŠ¨ç«¯é€‰ä¸­çŠ¶æ€è°ƒæ•´ */
            #matC .cell.selected {
                box-shadow:
                    0 0 0 2px rgba(110, 214, 167, 0.4),
                    4px 4px 8px rgba(0, 0, 0, 0.1),
                    -2px -2px 6px rgba(255, 255, 255, 0.8),
                    inset 2px 2px 4px rgba(255, 255, 255, 0.6);
            }

            @keyframes pulse-selected {
                0% {
                    box-shadow:
                        0 0 0 2px rgba(110, 214, 167, 0.3),
                        4px 4px 8px rgba(0, 0, 0, 0.1),
                        -2px -2px 6px rgba(255, 255, 255, 0.8),
                        inset 2px 2px 4px rgba(255, 255, 255, 0.6);
                }

                100% {
                    box-shadow:
                        0 0 0 2px rgba(110, 214, 167, 0.5),
                        4px 4px 8px rgba(0, 0, 0, 0.1),
                        -2px -2px 6px rgba(255, 255, 255, 0.8),
                        inset 2px 2px 4px rgba(255, 255, 255, 0.6);
                }
            }

            .operator {
                font-size: 1.2rem;
                margin: 0 2px;
            }

            .formula-container {
                flex-direction: column;
                gap: 10px;
            }

            .dock {
                padding: 8px 14px;
                gap: 5px;
                max-width: 90%;
                border-radius: 35px;
            }

            .slot {
                width: 32px;
                height: 32px;
                font-size: 0.85rem;
            }

            #solveBtn {
                padding: 7px 14px;
                font-size: 0.75rem;
            }

            .star {
                font-size: 1.8rem;
            }

            .status-container {
                padding: 6px 10px;
                max-width: 95%;
                margin-bottom: 10px;
            }

            .status-label {
                font-size: 0.95rem;
            }

            .hint-text {
                font-size: 0.8rem;
                padding: 0 8px;
            }

            .btn {
                padding: 8px 14px;
                font-size: 0.75rem;
            }

            #miniNotice {
                padding: 12px 20px;
                top: 50%;
                max-width: 90%;
            }

            .tools-area {
                margin-top: 5px;
                gap: 8px;
                max-width: 95%;
            }

            /* å¯¼èˆªæŒ‰é’®åœ¨ç§»åŠ¨ç«¯æ”¹ä¸ºæ¯è¡Œ2ä¸ª */
            .nav-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }

            .nav-button {
                font-size: 0.8rem;
                padding: 0.6rem 0.4rem;
            }

            .matrix-calc-banner {
                margin-top: 1rem;
                padding: 0.8rem;
            }

            .matrix-calc-banner h4 {
                font-size: 1rem;
            }

            .matrix-calc-button {
                padding: 0.5rem 0.9rem;
                font-size: 0.85rem;
            }

            /* SEOæ–‡ç« å®¹å™¨å“åº”å¼ */
            .seo-article-container {
                padding: 1rem !important;
                margin-top: 1rem;
            }

            .seo-article h1 {
                font-size: 1.8rem;
            }

            .seo-article h2 {
                font-size: 1.5rem;
            }

            .seo-article .section-header {
                margin-bottom: 15px;
            }

            .seo-article .gameplay-steps {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .wide-container {
                padding: 0 8px !important;
            }

            .dynamic-content-container {
                padding: 0.8rem !important;
                margin-bottom: 0.8rem;
            }

            /* å¯¼èˆªæŒ‰é’®åœ¨å°å±å¹•è®¾å¤‡ä¸Šçš„è°ƒæ•´ */
            .nav-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .nav-button {
                font-size: 0.75rem;
                padding: 0.5rem 0.3rem;
            }

            /* è¶…å°å±å¹•æ¸¸æˆä¼˜åŒ– */
            .game-title {
                font-size: 1.4rem;
                margin-bottom: 6px;
            }

            .game-wrapper {
                padding: 8px !important;
                border-radius: 16px;
            }

            .playground {
                padding: 10px 6px !important;
                border-radius: 16px;
                gap: 8px;
                max-width: 100%;
                margin-bottom: 8px;
            }

            .matrix {
                grid-template-columns: repeat(2, 45px) !important;
                gap: 5px;
                padding: 6px;
            }

            #matA,
            #matB {
                transform: scale(0.85);
            }

            .cell {
                width: 45px !important;
                height: 45px !important;
                font-size: 1rem !important;
            }

            .operator {
                font-size: 1.1rem !important;
                margin: 0 2px !important;
            }

            .formula-container {
                gap: 8px;
            }

            .dock {
                padding: 6px 10px !important;
                gap: 4px !important;
                border-radius: 25px;
                max-width: 100%;
            }

            .slot {
                width: 28px !important;
                height: 28px !important;
                font-size: 0.75rem !important;
            }

            #solveBtn {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            .star {
                font-size: 1.5rem;
            }

            .status-container {
                padding: 5px 8px;
                max-width: 100%;
                margin-bottom: 8px;
            }

            .status-label {
                font-size: 0.85rem;
            }

            .hint-text {
                font-size: 0.7rem;
            }

            .btn {
                padding: 7px 10px;
                font-size: 0.7rem;
            }

            #miniNotice {
                padding: 10px 15px;
                top: 50%;
                max-width: 95%;
            }

            .tools-area {
                gap: 6px;
            }

            .matrix-calc-banner {
                padding: 0.7rem;
            }

            .matrix-calc-banner h4 {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .matrix-calc-button {
                padding: 0.4rem 0.7rem;
                font-size: 0.8rem;
            }

            .seo-article-container {
                padding: 0.8rem !important;
                margin-top: 0.8rem;
            }

            .seo-article h1 {
                font-size: 1.6rem;
            }

            .seo-article h2 {
                font-size: 1.3rem;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .game-title {
                font-size: 1.8rem;
            }

            .stars-container {
                max-width: 90%;
            }

            .matrices {
                gap: 10px;
                max-width: 100%;
                justify-content: space-between;
            }

            .matrix {
                grid-template-columns: repeat(2, 55px) !important;
                gap: 7px;
                padding: 9px;
            }

            .cell {
                width: 55px !important;
                height: 55px !important;
                font-size: 1.2rem;
            }

            .operator {
                font-size: 1.4rem;
            }

            .slot {
                width: 35px;
                height: 35px;
            }

            .left-sidebar,
            .right-sidebar {
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <!-- é¡µçœ‰éƒ¨åˆ† -->
    <header>
        <div class="container">
            <h1 class="main-title">
                <span class="nded-text">NDED</span>
                <span class="subtitle">building mathematical confidence for life.</span>
            </h1>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-row-container">
        <div class="wide-container">
            <div class="main-row">
                <!-- å·¦ä¾§è¾¹æ  -->
                <div class="left-sidebar">
                    <h3 class="nav-title">Navigation</h3>
                    <div class="nav-buttons">
                        <a href="index.html" class="nav-button">Home</a>
                        <a href="about-us.html" class="nav-button">About us</a>
                        <a href="#content" class="nav-button">Content</a>
                        <a href="https://matrixcalcu.com/" target="_blank" class="nav-button external">Matrix
                            Calculator</a>
                    </div>

                    <!-- æ–°å¢ï¼šçŸ©é˜µè®¡ç®—å™¨è¾¹æ¡† -->
                    <div class="matrix-calc-banner">
                        <h4>Want to calculate actual matrices?</h4>
                        <a href="https://matrixcalcu.com/" target="_blank" class="matrix-calc-button">
                            Open Matrix Calculator
                        </a>
                    </div>
                </div>

                <!-- ä¸»å†…å®¹åŒºåŸŸ - æ¸¸æˆ -->
                <div class="main-content">
                    <div class="dynamic-content-container">
                        <!-- å·²ç§»é™¤æ–‡å­—éƒ¨åˆ† -->

                        <div class="game-wrapper">
                            <!-- éŸ³æ•ˆæ§åˆ¶æŒ‰é’® - ç§»åŠ¨åˆ°æ¸¸æˆå®¹å™¨å†…å³ä¸Šè§’ -->
                            <div class="sound-controls">
                                <button id="soundToggleBtn" class="sound-toggle-btn">ğŸ”Š</button>
                            </div>

                            <!-- æ¸¸æˆæ ‡é¢˜ -->
                            <h1 class="game-title">Matrix Multiplication Rules</h1>

                            <div id="miniNotice">
                                <h3 id="noticeTitle" style="margin:0; color: var(--clay-dark-bg);">Perfect!</h3>
                                <button class="btn btn-green" style="margin-top:10px" onclick="nextAction()">Continue
                                    â¡</button>
                            </div>

                            <!-- æ˜Ÿæ˜Ÿå’ŒçŠ¶æ€å®¹å™¨ -->
                            <div class="stars-container">
                                <div class="stars-row">
                                    <div class="star" id="s1">â˜…</div>
                                    <div class="star" id="s2">â˜…</div>
                                    <div class="star" id="s3">â˜…</div>
                                </div>
                            </div>

                            <div class="status-container">
                                <span class="status-label" id="statusLabel">Step 1: Introduction (Letters)</span>
                                <span class="hint-text" id="hintText">Tip: Tap a '?' in Matrix C to start
                                    weaving.</span>
                            </div>

                            <div class="playground">
                                <div class="matrices">
                                    <!-- ç¬¬ä¸€è¡Œï¼šçŸ©é˜µA Ã— çŸ©é˜µB -->
                                    <div class="matrix-row">
                                        <div class="matrix" id="matA">
                                            <div class="cell" data-r="0" data-c="0">a</div>
                                            <div class="cell" data-r="0" data-c="1">b</div>
                                            <div class="cell" data-r="1" data-c="0">c</div>
                                            <div class="cell" data-r="1" data-c="1">d</div>
                                        </div>
                                        <div class="operator">Ã—</div>
                                        <div class="matrix" id="matB">
                                            <div class="cell" data-r="0" data-c="0">e</div>
                                            <div class="cell" data-r="0" data-c="1">f</div>
                                            <div class="cell" data-r="1" data-c="0">g</div>
                                            <div class="cell" data-r="1" data-c="1">h</div>
                                        </div>
                                    </div>

                                    <!-- ç¬¬äºŒè¡Œï¼š= ç»“æœçŸ©é˜µ -->
                                    <div class="matrix-row">
                                        <div class="operator">=</div>
                                        <div class="matrix" id="matC">
                                            <div class="cell" onclick="startCell(0, 0, this)">?</div>
                                            <div class="cell" onclick="startCell(0, 1, this)">?</div>
                                            <div class="cell" onclick="startCell(1, 0, this)">?</div>
                                            <div class="cell" onclick="startCell(1, 1, this)">?</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- å…¬å¼åŒºåŸŸåŒ…å«dockå’ŒsolveæŒ‰é’® -->
                                <div class="formula-area">
                                    <div class="formula-container">
                                        <div class="dock" id="dock">
                                            <div class="slot slot-a" data-idx="0">?</div> <span
                                                style="color: var(--clay-primary); font-weight: bold;">Ã—</span>
                                            <div class="slot slot-b" data-idx="1">?</div> <span
                                                style="margin:0 5px; color: var(--clay-primary); font-weight: bold;">+</span>
                                            <div class="slot slot-a" data-idx="2">?</div> <span
                                                style="color: var(--clay-primary); font-weight: bold;">Ã—</span>
                                            <div class="slot slot-b" data-idx="3">?</div>
                                        </div>
                                        <button class="btn btn-green" id="solveBtn" onclick="solveActiveCell()">âš¡ Solve
                                            Current</button>
                                    </div>
                                </div>
                            </div>

                            <div class="tools-area">
                                <div id="masterExtras" style="display:none; gap:12px;">
                                    <button class="btn btn-gray" onclick="restartTraining()">ğŸ§  Restart
                                        Training</button>
                                    <a href="https://matrixcalcu.com/en/matrix-multiplication-calculator"
                                        target="_blank" class="btn btn-link">ğŸ“ˆ Matrix Calculator â†—</a>
                                    <button class="btn btn-blue"
                                        onclick="window.location.href='matrix-multiplication-by-3-game.html'">ğŸŒŒ Advance
                                        to 3x3</button>
                                </div>
                            </div>
                        </div>

                        <!-- ========== SEOæ–‡ç« éƒ¨åˆ† ========== -->
                        <div class="seo-article-container">
                            <article class="seo-article">
                                <header>
                                    <h1>Matrix Multiplication Rule Memory Game</h1>
                                    <p class="subtitle"> </p>
                                </header>

                                <main>
                                    <!-- Part 1: How to Play -->
                                    <div class="container">
                                        <div class="section-header">
                                            <div class="section-number">1</div>
                                            <h2>How to Play</h2>
                                        </div>

                                        <h3>Basic Gameplay</h3>

                                        <div class="gameplay-steps">
                                            <div class="step">
                                                <div class="step-number">1</div>
                                                <div>
                                                    <strong>Click to Start</strong> â†’ Click any "?" cell in the result
                                                    matrix (bottom matrix)
                                                </div>
                                            </div>

                                            <div class="step">
                                                <div class="step-number">2</div>
                                                <div>
                                                    <strong>Auto-Highlight</strong> â†’ The corresponding row in Matrix A
                                                    and column in Matrix B will highlight automatically
                                                </div>
                                            </div>

                                            <div class="step">
                                                <div class="step-number">3</div>
                                                <div>
                                                    <strong>Drag & Fill</strong> â†’ Drag highlighted cells into the
                                                    formula slots (Desktop: drag / Mobile: touch & drag)
                                                </div>
                                            </div>

                                            <div class="step">
                                                <div class="step-number">4</div>
                                                <div>
                                                    <strong>Complete Calculation</strong> â†’ The result calculates
                                                    automatically when all 4 slots are filled, or click "Solve Current"
                                                </div>
                                            </div>
                                        </div>

                                        <h3>Game Progression</h3>
                                        <ul>
                                            <li><strong>Level 1: Letter matrices</strong> - Learn basic rules</li>
                                            <li><strong>Level 2: Letter matrices</strong> - Practice & reinforce</li>
                                            <li><strong>Level 3: Number matrices</strong> - Actual calculations</li>
                                            <li><strong>Master Mode:</strong> Unlock advanced tools and 3Ã—3 matrices
                                            </li>
                                        </ul>

                                        <div class="tip-box">
                                            <h3>Key Tips</h3>
                                            <ul>
                                                <li>Earn a star for each level completed</li>
                                                <li>Matrix multiplication formula: C[row][col] = (A[row][0] Ã— B[0][col])
                                                    + (A[row][1] Ã— B[1][col])</li>
                                                <li>Use "Restart Training" to reset progress anytime</li>
                                                <li>Reach Master Mode to unlock more tools and challenges</li>
                                            </ul>
                                        </div>

                                        <!-- åµŒå…¥è§†é¢‘ï¼šåœ¨â€œ1. How to Playâ€éƒ¨åˆ†çš„ç»“å°¾å¤„æ’å…¥ -->
                                        <div class="video-section" style="margin-top: 25px;">
                                            <p
                                                style="font-weight: bold; color: #2c3e50; margin-bottom: 12px; text-align: center;">
                                                <i class="fas fa-play-circle"></i> Watch Video Tutorial: How to Play
                                                Matrix Weaver
                                            </p>
                                            <div class="video-responsive-container">
                                                <iframe
                                                    src="https://www.youtube.com/embed/H3C-vxsq64U?si=Wd1z8PtH7A3zOChy"
                                                    title="YouTube video player" frameborder="0"
                                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
                                                </iframe>
                                            </div>
                                        </div>

                                        <style>
                                            /* ç¡®ä¿è§†é¢‘æŒ‰ 16:9 æ¯”ä¾‹è‡ªé€‚åº” */
                                            .video-responsive-container {
                                                position: relative;
                                                padding-bottom: 56.25%;
                                                height: 0;
                                                overflow: hidden;
                                                max-width: 100%;
                                                background: #000;
                                                border-radius: 10px;
                                                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                                            }

                                            .video-responsive-container iframe {
                                                position: absolute;
                                                top: 0;
                                                left: 0;
                                                width: 100%;
                                                height: 100%;
                                            }
                                        </style>
                                    </div>

                                    <!-- Part 2: 2Ã—2 Matrix Multiplication Rules -->
                                    <div class="container">
                                        <div class="section-header">
                                            <div class="section-number">2</div>
                                            <h2>2Ã—2 Matrix Multiplication Rules</h2>
                                        </div>

                                        <p>In the 2Ã—2 matrix mode, learners focus on understanding the basic conditions
                                            required for matrix multiplication. A 2Ã—2 matrix can only be multiplied by
                                            another matrix if the number of columns in the first matrix matches the
                                            number of rows in the second matrix.</p>

                                        <p>When multiplying two compatible matrices, the result is a new matrix whose
                                            dimensions are determined by the outer dimensions of the original matrices.
                                            In the 2Ã—2 mode, this structure is easier to recognize, making it ideal for
                                            introducing matrix multiplication rules.</p>

                                        <p>This mode is designed for beginners who are learning to identify valid and
                                            invalid matrix combinations. By practicing with smaller matrices, students
                                            can build confidence and develop a clear mental model of matrix
                                            multiplication rules before moving on to more complex cases.</p>

                                        <div class="key-points">
                                            <div class="key-point">
                                                <h4>Compatibility Rule</h4>
                                                <p>Matrix A (mÃ—n) can multiply with Matrix B (pÃ—q) only if n = p
                                                    (columns of A = rows of B).</p>
                                            </div>

                                            <div class="key-point">
                                                <h4>Result Dimensions</h4>
                                                <p>The product matrix will have dimensions mÃ—q (rows from A, columns
                                                    from B).</p>
                                            </div>

                                            <div class="key-point">
                                                <h4>Learning Focus</h4>
                                                <p>2Ã—2 mode helps beginners visualize and internalize multiplication
                                                    rules before calculations.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Part 3: Matrix Multiplication Rule Memory Game -->
                                    <div class="container">
                                        <div class="section-header">
                                            <div class="section-number">3</div>
                                            <h2>Matrix Multiplication Rule Memory Game</h2>
                                        </div>

                                        <p>The <strong>Matrix Multiplication Rule Memory Game</strong> is an educational
                                            learning game designed to help students memorize and understand the rules of
                                            matrix multiplication. Instead of focusing on calculations, this game trains
                                            learners to recognize valid matrix sizes, multiplication conditions, and
                                            result dimensions through structured memory-based practice.</p>

                                        <h3>Why Memorizing Matrix Multiplication Rules Is Difficult</h3>

                                        <p>Many students struggle with matrix multiplication not because of arithmetic
                                            difficulty, but because the rules themselves are easy to forget. Common
                                            challenges include remembering when two matrices can be multiplied,
                                            determining the correct order, and identifying the dimensions of the
                                            resulting matrix.</p>

                                        <p>Traditional teaching often assumes these rules will be remembered naturally
                                            through repetition, but for many learners, this step requires focused and
                                            intentional practice.</p>

                                        <h3>Not a Matrix Calculator or Problem Solver</h3>

                                        <p>This game is not a matrix calculator and does not solve matrix multiplication
                                            problems automatically. Instead, it focuses exclusively on helping students
                                            internalize the rules behind matrix multiplication before performing
                                            calculations.</p>

                                        <p>By separating rule memorization from computation, learners build a stronger
                                            conceptual foundation and reduce confusion in later problem-solving tasks.
                                        </p>

                                        <h3>How the Matrix Multiplication Rule Memory Game Works</h3>

                                        <p>The game presents learners with matrix representations and rule-based
                                            questions that require them to recall and apply matrix multiplication
                                            conditions. Players must identify whether multiplication is possible and
                                            determine the correct result structure based on matrix dimensions.</p>

                                        <p>Through repeated interaction, feedback, and progression, students gradually
                                            transform abstract rules into intuitive knowledge.</p>

                                        <h3>What Makes This Learning Approach Different</h3>

                                        <p>While most learning tools focus on completing matrix multiplication
                                            exercises, few address the need to memorize the rules themselves. This game
                                            targets that often-overlooked learning gap by using game mechanics to
                                            reinforce rule recognition.</p>

                                        <p>The result is a lower cognitive load, reduced anxiety, and improved long-term
                                            retention of matrix multiplication rules.</p>

                                        <h3>Who This Game Is For</h3>

                                        <ul>
                                            <li>Middle school and high school students learning matrices</li>
                                            <li>College students reviewing linear algebra fundamentals</li>
                                            <li>Teachers looking for interactive classroom tools</li>
                                            <li>Self-learners who want to strengthen conceptual understanding</li>
                                        </ul>

                                        <h3>Educational Benefits</h3>

                                        <ul>
                                            <li>Improves recall of matrix multiplication conditions</li>
                                            <li>Builds confidence before performing calculations</li>
                                            <li>Encourages active learning through interaction</li>
                                            <li>Supports long-term conceptual understanding</li>
                                        </ul>

                                        <h3>Summary</h3>

                                        <p>The Matrix Multiplication Rule Memory Game is a focused learning tool that
                                            helps students master matrix multiplication rules through memory-based
                                            practice. By emphasizing understanding before calculation, it provides a
                                            clearer and more confident path into linear algebra.</p>
                                    </div>

                                    <!-- Part 4: For Teachers: Classroom Use -->
                                    <div class="container">
                                        <div class="section-header">
                                            <div class="section-number">4</div>
                                            <h2>For Teachers: Classroom Use</h2>
                                        </div>

                                        <p>The Matrix Multiplication Rule Memory Game is designed to support classroom
                                            instruction by making abstract matrix rules visible and interactive. It can
                                            be used as a teaching aid before formal calculations are introduced.</p>

                                        <!-- å›¾ç‰‡åŒºåŸŸ -->
                                        <div class="teacher-images">
                                            <div class="image-container">
                                                <img src="img/matrix-game-01.png" alt="Matrix Game Screenshot 1"
                                                    class="game-image">
                                                <p class="image-caption">Screenshot showing the 2Ã—2 matrix
                                                    multiplication interface</p>
                                            </div>

                                            <div class="image-container">
                                                <img src="img/matrix-game-02.png" alt="Matrix Game Screenshot 2"
                                                    class="game-image">
                                                <p class="image-caption">Screenshot showing the memory game practice
                                                    mode</p>
                                            </div>
                                        </div>

                                        <h3>How Teachers Can Use This Game</h3>
                                        <ul>
                                            <li>Introduce matrix multiplication rules before solving numerical problems
                                            </li>
                                            <li>Demonstrate valid and invalid matrix combinations visually</li>
                                            <li>Help students understand why matrix multiplication order matters</li>
                                            <li>Engage students in quick rule-check activities during lessons</li>
                                        </ul>

                                        <h3>Suggested Classroom Scenarios</h3>
                                        <ul>
                                            <li>Whole-class demonstration using the 2Ã—2 mode for initial explanation
                                            </li>
                                            <li>Small group practice to reinforce rule recognition</li>
                                            <li>Warm-up or review activity before problem-solving sessions</li>
                                        </ul>

                                        <h3>Why This Game Works in Teaching</h3>
                                        <ul>
                                            <li>Focuses on rules and structure rather than calculation</li>
                                            <li>Reduces cognitive load for students new to matrices</li>
                                            <li>Provides immediate visual feedback</li>
                                            <li>No setup or prior training required</li>
                                        </ul>

                                        <p>By separating rule memorization from computation, teachers can help students
                                            build a stronger conceptual foundation in matrix multiplication and linear
                                            algebra.</p>
                                    </div>
                                </main>

                                <footer>
                                    <p>Matrix Multiplication Game Educational Guide | Designed for Interactive Learning
                                    </p>
                                    <p>Â© 2026 Matrix Learning Tools. All educational content is freely available for
                                        classroom use.</p>
                                </footer>
                            </article>
                        </div>
                        <!-- ========== SEOæ–‡ç« éƒ¨åˆ†ç»“æŸ ========== -->
                    </div>
                </div>

                <!-- å³ä¾§è¾¹æ  -->
                <div class="right-sidebar">
                    <div class="question-box">
                        <h2>Do you enjoy learning math?</h2>
                        <button class="btn yes">Yes, I love math!</button>
                        <button class="btn no">Math is challenging for me</button>
                        <div class="response" id="response"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„šéƒ¨åˆ† -->
    <footer>
        <div class="container">
            <p>&copy; 2026 NDED - Building Mathematical Confidence for Life. All rights reserved.</p>
        </div>
    </footer>

    <!-- æ¸¸æˆJavaScriptä»£ç  -->
    <script>
        /* ================== Audio Manager ================== */
        const AudioManager = {
            enabled: true,
            sounds: {},

            init() {
                // è¯»å–æœ¬åœ°å­˜å‚¨çŠ¶æ€
                const saved = localStorage.getItem('matrix_game_sound');
                if (saved !== null) {
                    this.enabled = saved === 'true';
                }

                // åˆ›å»ºéŸ³é¢‘å¯¹è±¡
                this.sounds.correct = new Audio('assets/audio/correct.mp3');
                this.sounds.wrong = new Audio('assets/audio/wrong.mp3');
                this.sounds.complete = new Audio('assets/audio/complete.mp3');

                Object.values(this.sounds).forEach(sound => {
                    sound.volume = 0.6;
                });

                this.updateUI();
            },

            play(name) {
                if (!this.enabled) return;
                const sound = this.sounds[name];
                if (!sound) return;

                sound.currentTime = 0;
                sound.play().catch(() => { });
            },

            toggle() {
                this.enabled = !this.enabled;
                localStorage.setItem('matrix_game_sound', this.enabled);
                this.updateUI();
            },

            updateUI() {
                const btn = document.getElementById('soundToggleBtn');
                if (!btn) return;

                if (this.enabled) {
                    btn.innerText = 'ğŸ”Š';
                    btn.classList.remove('muted');
                } else {
                    btn.innerText = 'ğŸ”‡';
                    btn.classList.add('muted');
                }
            }
        };
        /* ================== End Audio Manager ================== */

        // è®¾å¤‡æ£€æµ‹
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        // æ¸¸æˆçŠ¶æ€
        let state = {
            level: 0,
            solved: 0,
            target: null,
            master: false,
            dragged: null,
            isDragging: false,
            dragStartX: 0,
            dragStartY: 0,
            dragClone: null,
            currentSlotHover: null,
            dragOffsetX: 0,
            dragOffsetY: 0,
            slotRects: null,
            needsUpdate: false,
            currentTransformX: 0,
            currentTransformY: 0,
            pointerId: null
        };

        // è¯»å–ä¿å­˜çš„è¿›åº¦
        const savedLevel = localStorage.getItem('matrix_weaver_level');
        if (savedLevel !== null) {
            state.level = parseInt(savedLevel);
            // ç‚¹äº®æ˜Ÿæ˜Ÿ
            for (let i = 1; i <= state.level; i++) {
                const star = document.getElementById('s' + i);
                if (star) star.classList.add('active');
            }

            // å¦‚æœå·²ç»è¾¾åˆ°ç¬¬ä¸‰å…³ï¼Œè®¾ç½®çŸ©é˜µä¸ºæ•°å­—
            if (state.level >= 2) {
                document.querySelectorAll('#matA .cell, #matB .cell').forEach(cell => {
                    if (cell.parentNode.id !== 'matC') {
                        cell.innerText = Math.floor(Math.random() * 10);
                    }
                });
            }

            // å¦‚æœå·²ç»æ˜¯å¤§å¸ˆçº§ï¼Œæ˜¾ç¤ºé¢å¤–æŒ‰é’®
            if (state.level >= 3) {
                state.master = true;
                document.getElementById('masterExtras').style.display = 'flex';
            }
        }

        // åˆå§‹åŒ–äº‹ä»¶
        function initEvents() {
            const cells = document.querySelectorAll('#matA .cell, #matB .cell');
            const slots = document.querySelectorAll('.slot');

            // ç»Ÿä¸€ä½¿ç”¨ Pointer Events
            initPointerDrag(cells, slots);

            // ä¸ºæ¡Œé¢ç«¯ä¿ç•™åŸæœ‰çš„æ‹–æ‹½å±æ€§ï¼ˆå‘åå…¼å®¹ï¼‰
            if (!isTouchDevice) {
                cells.forEach(cell => {
                    cell.setAttribute('draggable', 'true');
                });
            }
        }

        // ç»Ÿä¸€Pointer Eventsæ‹–æ‹½å®ç°
        function initPointerDrag(cells, slots) {
            // æŒ‰ä¸‹äº‹ä»¶
            cells.forEach(cell => {
                cell.addEventListener('pointerdown', function (e) {
                    if (!state.target) return;

                    e.preventDefault();
                    e.stopPropagation();

                    state.isDragging = true;
                    state.dragged = cell;
                    state.dragStartX = e.clientX;
                    state.dragStartY = e.clientY;
                    state.pointerId = e.pointerId;

                    // è·å–å…ƒç´ ä½ç½®ï¼Œç”¨äºè®¡ç®—åç§»
                    const rect = cell.getBoundingClientRect();
                    state.dragOffsetX = e.clientX - rect.left;
                    state.dragOffsetY = e.clientY - rect.top;

                    // åˆ›å»ºæ‹–æ‹½å…‹éš†
                    createDragClone(cell, e.clientX, e.clientY);
                    cell.classList.add('selected');

                    // é¢„ç¼“å­˜æ‰€æœ‰æ’æ§½çš„è¾¹ç•ŒçŸ©å½¢
                    cacheSlotRects(slots);

                    // è®¾ç½®pointeræ•è·
                    cell.setPointerCapture && cell.setPointerCapture(e.pointerId);

                }, { passive: false });
            });

            // ç§»åŠ¨äº‹ä»¶
            document.addEventListener('pointermove', function (e) {
                if (!state.isDragging || !state.dragged) return;

                e.preventDefault();
                e.stopPropagation();

                // ä½¿ç”¨rAFèŠ‚æµæ›´æ–°ä½ç½®
                state.currentTransformX = e.clientX - state.dragStartX;
                state.currentTransformY = e.clientY - state.dragStartY;

                // æ£€æŸ¥æ˜¯å¦æ‚¬åœåœ¨æ’æ§½ä¸Š
                checkSlotHover(e.clientX, e.clientY);

                // æ ‡è®°éœ€è¦æ›´æ–°
                if (!state.needsUpdate) {
                    state.needsUpdate = true;
                    requestAnimationFrame(updateDragClonePosition);
                }

            }, { passive: false });

            // é‡Šæ”¾äº‹ä»¶
            document.addEventListener('pointerup', function (e) {
                if (!state.isDragging || !state.dragged) return;

                e.preventDefault();
                e.stopPropagation();

                // å®Œæˆæ‹–æ‹½
                finishDrag(e.clientX, e.clientY);
                cleanupDrag();

            }, { passive: false });

            // å–æ¶ˆäº‹ä»¶
            document.addEventListener('pointercancel', function (e) {
                if (state.isDragging) {
                    cleanupDrag();
                }
            }, { passive: false });

            // æ’æ§½æ‚¬åœæ£€æµ‹
            slots.forEach(slot => {
                slot.addEventListener('pointerenter', function (e) {
                    if (state.isDragging && state.dragged) {
                        this.classList.add('hover');
                        state.currentSlotHover = this;
                    }
                });

                slot.addEventListener('pointerleave', function (e) {
                    if (state.isDragging && state.dragged) {
                        this.classList.remove('hover');
                        if (state.currentSlotHover === this) {
                            state.currentSlotHover = null;
                        }
                    }
                });

                slot.addEventListener('pointerup', function (e) {
                    if (state.isDragging && state.dragged && state.currentSlotHover === this) {
                        e.preventDefault();
                        e.stopPropagation();
                        handleDropOnSlot(this);
                        cleanupDrag();
                    }
                }, { passive: false });
            });
        }

        // é¢„ç¼“å­˜æ’æ§½è¾¹ç•ŒçŸ©å½¢
        function cacheSlotRects(slots) {
            state.slotRects = [];
            slots.forEach(slot => {
                const rect = slot.getBoundingClientRect();
                state.slotRects.push({
                    left: rect.left,
                    top: rect.top,
                    right: rect.right,
                    bottom: rect.bottom,
                    width: rect.width,
                    height: rect.height,
                    element: slot
                });
            });
        }

        // æ£€æŸ¥æ’æ§½æ‚¬åœï¼ˆä½¿ç”¨é¢„ç¼“å­˜çš„çŸ©å½¢ï¼‰
        function checkSlotHover(x, y) {
            // æ¸…é™¤ä¹‹å‰çš„æ‚¬åœçŠ¶æ€
            if (state.currentSlotHover) {
                state.currentSlotHover.classList.remove('hover');
                state.currentSlotHover = null;
            }

            // ä½¿ç”¨é¢„ç¼“å­˜çš„çŸ©å½¢è¿›è¡Œæ•°å­¦è®¡ç®—
            if (state.slotRects) {
                for (const rect of state.slotRects) {
                    if (x >= rect.left && x <= rect.right &&
                        y >= rect.top && y <= rect.bottom) {
                        rect.element.classList.add('hover');
                        state.currentSlotHover = rect.element;
                        break;
                    }
                }
            }
        }

        // ä½¿ç”¨requestAnimationFrameæ›´æ–°æ‹–æ‹½å…‹éš†ä½ç½®
        function updateDragClonePosition() {
            if (!state.dragClone || !state.needsUpdate) return;

            // ä½¿ç”¨transformè¿›è¡ŒGPUåŠ é€Ÿæ¸²æŸ“
            state.dragClone.style.transform =
                `translate3d(${state.currentTransformX}px, ${state.currentTransformY}px, 0)`;

            state.needsUpdate = false;
        }

        // åˆ›å»ºæ‹–æ‹½å…‹éš†ï¼ˆä½¿ç”¨transformå®šä½ï¼‰
        function createDragClone(cell, x, y) {
            if (state.dragClone) state.dragClone.remove();

            state.dragClone = cell.cloneNode(true);
            state.dragClone.classList.add('drag-clone');

            // è®¾ç½®åˆå§‹ä½ç½®
            const rect = cell.getBoundingClientRect();
            state.dragClone.style.left = rect.left + 'px';
            state.dragClone.style.top = rect.top + 'px';
            state.dragClone.style.transform = 'translate3d(0, 0, 0)';

            document.body.appendChild(state.dragClone);
        }

        // å®Œæˆæ‹–æ‹½
        function finishDrag(x, y) {
            if (state.currentSlotHover) {
                handleDropOnSlot(state.currentSlotHover);
            }
        }

        // å¤„ç†æ”¾ç½®åˆ°æ’æ§½
        function handleDropOnSlot(slot) {
            if (!state.target || !state.dragged) return;
            processDrop(slot, state.dragged);
        }

        // å¤„ç†æ”¾ç½®é€»è¾‘
        function processDrop(slot, draggedCell) {
            const idx = parseInt(slot.dataset.idx);
            const r = parseInt(draggedCell.dataset.r), c = parseInt(draggedCell.dataset.c);
            const isA = draggedCell.parentNode.id === 'matA';

            let correct = false;
            if (idx === 0) correct = (isA && r === state.target.r && c === 0);
            if (idx === 1) correct = (!isA && r === 0 && c === state.target.c);
            if (idx === 2) correct = (isA && r === state.target.r && c === 1);
            if (idx === 3) correct = (!isA && r === 1 && c === state.target.c);

            if (correct && !slot.classList.contains('filled')) {
                // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                AudioManager.play('correct');

                slot.innerText = draggedCell.innerText;
                slot.classList.add('filled');
                slot.style.backgroundColor = isA ? 'var(--clay-primary)' : 'var(--clay-accent-yellow)';
                state.target.count++;

                if (state.target.count === 4) {
                    // å•å…ƒæ ¼å®ŒæˆéŸ³æ•ˆï¼ˆå•ä¸ªå•å…ƒæ ¼å®Œæˆï¼‰- æ”¹ä¸ºcorrect.mp3
                    AudioManager.play('correct');
                    endCell();
                }

                slot.classList.remove('hover');
            } else {
                // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                AudioManager.play('wrong');
            }
        }

        // æ¸…ç†æ‹–æ‹½çŠ¶æ€
        function cleanupDrag() {
            state.isDragging = false;

            if (state.dragClone) {
                state.dragClone.remove();
                state.dragClone = null;
            }

            if (state.dragged) {
                state.dragged.classList.remove('selected');
                // é‡Šæ”¾pointeræ•è·
                if (state.dragged.releasePointerCapture && state.pointerId !== null) {
                    state.dragged.releasePointerCapture(state.pointerId);
                }
            }

            if (state.currentSlotHover) {
                state.currentSlotHover.classList.remove('hover');
                state.currentSlotHover = null;
            }

            state.dragged = null;
            state.slotRects = null;
            state.needsUpdate = false;
            state.pointerId = null;
        }

        // æ¸¸æˆæ ¸å¿ƒå‡½æ•°
        function startCell(r, c, el) {
            if (el.classList.contains('done')) return;

            // æ¸…é™¤æ‰€æœ‰ç»“æœçŸ©é˜µå•å…ƒæ ¼çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('#matC .cell').forEach(cell => {
                cell.classList.remove('selected');
            });

            // ä¸ºå½“å‰ç‚¹å‡»çš„å•å…ƒæ ¼æ·»åŠ é€‰ä¸­çŠ¶æ€
            el.classList.add('selected');

            const hint = document.getElementById('hintText');
            if (hint) hint.style.display = 'none';

            state.target = { r, c, el, count: 0 };

            document.querySelectorAll('#matA .cell, #matB .cell').forEach(c => {
                c.classList.remove('highlight');
                c.classList.remove('selected');
            });
            document.querySelectorAll('.slot').forEach(s => {
                s.classList.remove('hover');
            });
            document.getElementById('dock').classList.add('show');

            if (state.level >= 1) {
                document.getElementById('solveBtn').style.display = 'block';
            }

            document.querySelectorAll('.slot').forEach(s => {
                s.innerText = '?';
                s.className = s.classList.contains('slot-a') ? 'slot slot-a' : 'slot slot-b';
                s.style.backgroundColor = "";
                s.classList.remove('filled');
            });

            document.querySelectorAll('#matA .cell').forEach(cell => {
                if (parseInt(cell.dataset.r) === r) cell.classList.add('highlight');
            });
            document.querySelectorAll('#matB .cell').forEach(cell => {
                if (parseInt(cell.dataset.c) === c) cell.classList.add('highlight');
            });

            if (isTouchDevice) {
                setTimeout(() => {
                    const hintElement = document.getElementById('hintText');
                    if (hintElement) {
                        hintElement.style.display = 'block';
                        hintElement.innerText = "Touch and drag a cell to a slot";
                        hintElement.style.color = 'var(--clay-accent-yellow)';
                        hintElement.style.fontWeight = 'bold';

                        setTimeout(() => {
                            if (hintElement) {
                                hintElement.innerText = "Tip: Tap a '?' in Matrix C to start weaving.";
                                hintElement.style.color = '';
                                hintElement.style.fontWeight = '';
                            }
                        }, 3000);
                    }
                }, 500);
            }
        }

        function endCell() {
            document.querySelectorAll('#matA .cell.highlight, #matB .cell.highlight').forEach(cell => {
                cell.classList.remove('highlight');
            });

            if (!state.target || !state.target.el) {
                console.warn('endCellè¢«è°ƒç”¨æ—¶ï¼Œtargetå·²æ— æ•ˆã€‚ä»…æ¸…ç†çŠ¶æ€ã€‚');
                document.getElementById('dock').classList.remove('show');
                if (document.getElementById('solveBtn')) {
                    document.getElementById('solveBtn').style.display = 'none';
                }
                return;
            }

            const t = state.target;

            // ç§»é™¤é€‰ä¸­çŠ¶æ€ï¼Œæ·»åŠ å®ŒæˆçŠ¶æ€
            t.el.classList.remove('selected');
            t.el.classList.add('done');

            // ä¿®å¤ï¼šç¬¬2å…³åŠä»¥åéƒ½è®¡ç®—æ•°å€¼ç»“æœ
            if (state.level >= 2) {
                const s = Array.from(document.querySelectorAll('.slot')).map(x => parseInt(x.innerText) || 0);
                t.el.innerText = (s[0] * s[1]) + (s[2] * s[3]);
            } else {
                t.el.innerText = "DONE";
            }

            document.getElementById('dock').classList.remove('show');
            document.getElementById('solveBtn').style.display = 'none';

            if (state.isDragging) cleanupDrag();

            state.solved++;

            // æ£€æŸ¥æ˜¯å¦å®Œæˆæ•´ä¸ªçŸ©é˜µï¼ˆ4ä¸ªå•å…ƒæ ¼ï¼‰
            if (state.solved === 4) {
                // æ’­æ”¾å…³å¡å®ŒæˆéŸ³æ•ˆ - ä¿æŒä½¿ç”¨complete.mp3
                AudioManager.play('complete');

                state.level++;

                // ä¿å­˜è¿›åº¦åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('matrix_weaver_level', state.level);

                // ç‚¹äº®æ˜Ÿæ˜Ÿ
                document.getElementById('s' + state.level).classList.add('active');

                if (state.level < 3) {
                    showNotice("Level Complete!", "Ready for the next one?");
                } else {
                    state.master = true;
                    showNotice("Master Unlocked!", "You have the tools of a Master now.");
                    document.getElementById('masterExtras').style.display = 'flex';
                }
            }
        }

        function solveActiveCell() {
            if (!state.target) return;
            const r = state.target.r;
            const c = state.target.c;
            const cellsA = Array.from(document.querySelectorAll('#matA .cell'));
            const cellsB = Array.from(document.querySelectorAll('#matB .cell'));
            const slots = document.querySelectorAll('.slot');
            slots[0].innerText = cellsA[r * 2].innerText;
            slots[1].innerText = cellsB[c].innerText;
            slots[2].innerText = cellsA[r * 2 + 1].innerText;
            slots[3].innerText = cellsB[c + 2].innerText;
            endCell();
        }

        function showNotice(title, body) {
            document.getElementById('noticeTitle').innerText = title;
            document.getElementById('miniNotice').style.display = 'block';
        }

        function nextAction() {
            document.getElementById('miniNotice').style.display = 'none';

            // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('#matC .cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });

            if (state.level < 3) {
                setupUI();
            } else {
                // ç¬¬3å…³åŠä»¥åçš„ç‰¹æ®Šå¤„ç†
                state.solved = 0;
                const stepLabels = ["Introduction (Letters)", "Practice (Letters)", "Challenge (Numbers)", "Master Mode"];
                const labelIndex = Math.min(state.level, 3);
                document.getElementById('statusLabel').innerText = "Step " + (state.level + 1) + ": " + stepLabels[labelIndex];

                document.querySelectorAll('#matC .cell').forEach(c => {
                    c.innerText = '?';
                    c.className = 'cell';
                });

                // ä¿®å¤ï¼šç¬¬2å…³åŠä»¥åéƒ½ä½¿ç”¨æ•°å­—çŸ©é˜µ
                if (state.level >= 2) {
                    document.querySelectorAll('#matA .cell, #matB .cell').forEach(cell => {
                        if (cell.parentNode.id !== 'matC') {
                            cell.innerText = Math.floor(Math.random() * 10);
                        }
                    });
                }
            }
        }

        function setupUI() {
            state.solved = 0;
            const stepLabels = ["Introduction (Letters)", "Practice (Letters)", "Challenge (Numbers)", "Master Mode"];
            const labelIndex = Math.min(state.level, 3);
            document.getElementById('statusLabel').innerText = "Step " + (state.level + 1) + ": " + stepLabels[labelIndex];

            // æ¸…é™¤æ‰€æœ‰ç»“æœçŸ©é˜µå•å…ƒæ ¼çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('#matC .cell').forEach(c => {
                c.innerText = '?';
                c.className = 'cell'; // è¿™ä¼šç§»é™¤æ‰€æœ‰ç±»åï¼ŒåŒ…æ‹¬selectedå’Œdone
            });

            // ä¿®å¤ï¼šç¬¬2å…³åŠä»¥åéƒ½ä½¿ç”¨æ•°å­—çŸ©é˜µ
            if (state.level >= 2) {
                document.querySelectorAll('#matA .cell, #matB .cell').forEach(cell => {
                    if (cell.parentNode.id !== 'matC') {
                        cell.innerText = Math.floor(Math.random() * 10);
                    }
                });
            }
        }

        function restartTraining() {
            // æ¸…é™¤ä¿å­˜çš„è¿›åº¦
            localStorage.removeItem('matrix_weaver_level');

            state.level = 0;
            state.solved = 0;
            state.master = false;
            document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            document.getElementById('hintText').style.display = 'block';
            document.getElementById('hintText').innerText = "Tip: Tap a '?' in Matrix C to start weaving.";

            if (state.isDragging) cleanupDrag();

            const labelsA = ['a', 'b', 'c', 'd'], labelsB = ['e', 'f', 'g', 'h'];
            document.querySelectorAll('#matA .cell').forEach((c, i) => {
                c.innerText = labelsA[i];
                c.draggable = !isTouchDevice;
            });
            document.querySelectorAll('#matB .cell').forEach((c, i) => {
                c.innerText = labelsB[i];
                c.draggable = !isTouchDevice;
            });
            setupUI();
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            initEvents();
            // åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨
            AudioManager.init();

            // ä¸ºéŸ³æ•ˆå¼€å…³æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.getElementById('soundToggleBtn')
                .addEventListener('click', function () {
                    AudioManager.toggle();
                });

            // æ ¹æ®ä¿å­˜çš„è¿›åº¦è®¾ç½®UI
            if (state.level > 0) {
                // æ›´æ–°çŠ¶æ€æ ‡ç­¾
                const stepLabels = ["Introduction (Letters)", "Practice (Letters)", "Challenge (Numbers)", "Master Mode"];
                const labelIndex = Math.min(state.level, 3);
                document.getElementById('statusLabel').innerText = "Step " + (state.level + 1) + ": " + stepLabels[labelIndex];

                // å¦‚æœå·²ç»å®Œæˆæ‰€æœ‰å…³å¡ï¼Œæ˜¾ç¤ºé¢å¤–æŒ‰é’®
                if (state.level >= 3) {
                    document.getElementById('masterExtras').style.display = 'flex';
                }
            }
        });

        // é˜²æ­¢é¡µé¢æ»šåŠ¨
        document.addEventListener('touchmove', function (e) {
            if (state.isDragging) e.preventDefault();
        }, { passive: false });
    </script>

    <!-- æ¨¡æ¿JavaScriptä»£ç  -->
    <script>
        // é—®ç­”æ åŠŸèƒ½
        function initPoll() {
            const yesBtn = document.querySelector('.question-box .yes');
            const noBtn = document.querySelector('.question-box .no');
            const response = document.getElementById('response');

            yesBtn.addEventListener('click', () => {
                response.textContent = "That's great! Math is an amazing tool for understanding the world! ğŸ§®";
                response.classList.add('show');
            });

            noBtn.addEventListener('click', () => {
                response.textContent = "We're here to help! Our resources are designed to make math easier and more fun. ğŸ‘";
                response.classList.add('show');
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // åˆå§‹åŒ–é—®ç­”æ 
            initPoll();
        });
    </script>
</body>

</html>